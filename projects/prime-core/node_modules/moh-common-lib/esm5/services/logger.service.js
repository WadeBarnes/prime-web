/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { AbstractHttpService } from './abstract-api-service';
import { throwError } from 'rxjs';
import * as moment_ from 'moment';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
/** @type {?} */
var moment = moment_;
var CommonLogger = /** @class */ (function (_super) {
    tslib_1.__extends(CommonLogger, _super);
    function CommonLogger(http) {
        var _this = _super.call(this, http) || this;
        _this.http = http;
        /**
         * The HTTP Headers which go with each request.  These MUST be set if you are
         * using the logger.  Fields include:
         *
         * - program (REQUIRED, the application wide code)
         * - applicationId (REQUIRED, like sessionId)
         * - request_method (REQUIRED, 'POST')
         * - logsource: (REQUIRED, window.location.hostname)
         * - http_x_forwarded_host (REQUIRED, window.location.hostname)
         *
         */
        _this._headers = new HttpHeaders({
            request_method: 'POST',
            logsource: window.location.hostname,
            http_x_forwarded_host: window.location.hostname
        });
        _this.url = null;
        return _this;
    }
    Object.defineProperty(CommonLogger.prototype, "applicationId", {
        get: /**
         * @return {?}
         */
        function () {
            return this._headers.get('applicationId');
        },
        set: /**
         * @param {?} id
         * @return {?}
         */
        function (id) {
            this._headers = this._headers.set('applicationId', id);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CommonLogger.prototype, "programName", {
        get: /**
         * @return {?}
         */
        function () {
            return this._headers.get('name');
        },
        set: /**
         * @param {?} name
         * @return {?}
         */
        function (name) {
            this._headers = this._headers.set('program', name);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} newURL
     * @return {?}
     */
    CommonLogger.prototype.setURL = /**
     * @param {?} newURL
     * @return {?}
     */
    function (newURL) {
        this.url = newURL;
    };
    /**
     * @param {?} message
     * @return {?}
     */
    CommonLogger.prototype.log = /**
     * @param {?} message
     * @return {?}
     */
    function (message) {
        this._log((/** @type {?} */ (message)));
    };
    /**
     * @param {?} errorMessage
     * @return {?}
     */
    CommonLogger.prototype.logError = /**
     * @param {?} errorMessage
     * @return {?}
     */
    function (errorMessage) {
        this._logError((/** @type {?} */ (errorMessage)));
    };
    /**
     * Log a message to Splunk. This is the main way to send logs and
     * automatically includes meta-data. You do **not** need to subscribe to the
     * response, as the service already does that. The input object must have an
     * 'event' property set, everything else is optional.
     *
     * Example:
     * ```
      this.logService.log({
         event: 'submission',
         dateObj: new Date()
      });
      ```
     * @param message A JavaScript object, nesting is fine, with `event` property
     * set.
     */
    /**
     * Log a message to Splunk. This is the main way to send logs and
     * automatically includes meta-data. You do **not** need to subscribe to the
     * response, as the service already does that. The input object must have an
     * 'event' property set, everything else is optional.
     *
     * Example:
     * ```
     * this.logService.log({
     * event: 'submission',
     * dateObj: new Date()
     * });
     * ```
     * @protected
     * @param {?} message A JavaScript object, nesting is fine, with `event` property
     * set.
     * @return {?}
     */
    CommonLogger.prototype._log = /**
     * Log a message to Splunk. This is the main way to send logs and
     * automatically includes meta-data. You do **not** need to subscribe to the
     * response, as the service already does that. The input object must have an
     * 'event' property set, everything else is optional.
     *
     * Example:
     * ```
     * this.logService.log({
     * event: 'submission',
     * dateObj: new Date()
     * });
     * ```
     * @protected
     * @param {?} message A JavaScript object, nesting is fine, with `event` property
     * set.
     * @return {?}
     */
    function (message) {
        this.setSeverity(SeverityLevels.INFO);
        return this._sendLog(message);
    };
    /**
     * @protected
     * @param {?} errorMessage
     * @return {?}
     */
    CommonLogger.prototype._logError = /**
     * @protected
     * @param {?} errorMessage
     * @return {?}
     */
    function (errorMessage) {
        this.setSeverity(SeverityLevels.ERROR);
        return this._sendLog(errorMessage);
    };
    /**
     * Log HTTP errors, e.g. when losing network connectivity or receiving an
     * error response code.
     */
    /**
     * Log HTTP errors, e.g. when losing network connectivity or receiving an
     * error response code.
     * @param {?} error
     * @return {?}
     */
    CommonLogger.prototype.logHttpError = /**
     * Log HTTP errors, e.g. when losing network connectivity or receiving an
     * error response code.
     * @param {?} error
     * @return {?}
     */
    function (error) {
        return this._logError({
            event: 'error',
            message: error.message,
            errorName: error.name,
            statusText: error.statusText
        });
    };
    /**
     * Internal method to send logs to Splunk, includes meta-data except that's
     * consistent across all requests, but not specific values like severity
     * level.
     *
     * @param message A JavaScript object or anything that can be toString()'d,
     * like Date
     */
    /**
     * Internal method to send logs to Splunk, includes meta-data except that's
     * consistent across all requests, but not specific values like severity
     * level.
     *
     * @private
     * @param {?} message A JavaScript object or anything that can be toString()'d,
     * like Date
     * @return {?}
     */
    CommonLogger.prototype._sendLog = /**
     * Internal method to send logs to Splunk, includes meta-data except that's
     * consistent across all requests, but not specific values like severity
     * level.
     *
     * @private
     * @param {?} message A JavaScript object or anything that can be toString()'d,
     * like Date
     * @return {?}
     */
    function (message) {
        // Update headers
        this.setTimestamp();
        this.setTags(message.event);
        if (this.url === null) {
            /** @type {?} */
            var msg = 'Unable to send logs as URL as not been set via setURL()';
            console.error(msg);
            return throwError(msg);
        }
        // Configure request
        /** @type {?} */
        var body = { message: message };
        // We call .subscribe() here because we don't care about the response and
        // we want to ensure that we never forget to call subscribe.
        return this.post(this.url, body).subscribe();
    };
    /**
     * @protected
     * @param {?} error
     * @return {?}
     */
    CommonLogger.prototype.handleError = /**
     * @protected
     * @param {?} error
     * @return {?}
     */
    function (error) {
        console.log('logService handleError()', error);
        if (error.error instanceof ErrorEvent) {
            // Client-side / network error occured
            console.error('An error occured: ', error.error.message);
        }
        else {
            // The backend returned an unsuccessful response code
            console.error("Backend returned error code: " + error.status + ".  Error body: " + error.error);
        }
        return throwError(error);
    };
    Object.defineProperty(CommonLogger.prototype, "httpOptions", {
        /**
         * Overwrite the inherited httpOptions so we can set responseType to text.
         * This updates Angular's parsing, and it won't error out due to the server
         * not responding with JSON.
         */
        get: /**
         * Overwrite the inherited httpOptions so we can set responseType to text.
         * This updates Angular's parsing, and it won't error out due to the server
         * not responding with JSON.
         * @protected
         * @return {?}
         */
        function () {
            return {
                headers: this._headers,
                responseType: 'text'
            };
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @private
     * @return {?}
     */
    CommonLogger.prototype.setTimestamp = /**
     * @private
     * @return {?}
     */
    function () {
        this._headers = this._headers.set('timestamp', moment().toISOString());
    };
    /**
     * @private
     * @param {?} severity
     * @return {?}
     */
    CommonLogger.prototype.setSeverity = /**
     * @private
     * @param {?} severity
     * @return {?}
     */
    function (severity) {
        this._headers = this._headers.set('severity', severity);
    };
    /**
     * The headers are easier to search in splunk, and we aren't using tags, so
     * repurpose it to event type.
     */
    /**
     * The headers are easier to search in splunk, and we aren't using tags, so
     * repurpose it to event type.
     * @private
     * @param {?} message
     * @return {?}
     */
    CommonLogger.prototype.setTags = /**
     * The headers are easier to search in splunk, and we aren't using tags, so
     * repurpose it to event type.
     * @private
     * @param {?} message
     * @return {?}
     */
    function (message) {
        this._headers = this._headers.set('tags', message);
    };
    CommonLogger.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    CommonLogger.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    /** @nocollapse */ CommonLogger.ngInjectableDef = i0.defineInjectable({ factory: function CommonLogger_Factory() { return new CommonLogger(i0.inject(i1.HttpClient)); }, token: CommonLogger, providedIn: "root" });
    return CommonLogger;
}(AbstractHttpService));
export { CommonLogger };
if (false) {
    /**
     * The HTTP Headers which go with each request.  These MUST be set if you are
     * using the logger.  Fields include:
     *
     * - program (REQUIRED, the application wide code)
     * - applicationId (REQUIRED, like sessionId)
     * - request_method (REQUIRED, 'POST')
     * - logsource: (REQUIRED, window.location.hostname)
     * - http_x_forwarded_host (REQUIRED, window.location.hostname)
     *
     * @type {?}
     * @protected
     */
    CommonLogger.prototype._headers;
    /**
     * @type {?}
     * @private
     */
    CommonLogger.prototype.url;
    /**
     * @type {?}
     * @protected
     */
    CommonLogger.prototype.http;
}
/** @enum {string} */
var SeverityLevels = {
    INFO: 'info',
    ERROR: 'error',
};
/**
 * @record
 */
export function CommonLogMessage() { }
if (false) {
    /**
     * The type of event being logged.
     * @type {?}
     */
    CommonLogMessage.prototype.event;
    /* Skipping unhandled member: [key: string]: any;*/
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9nZ2VyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9tb2gtY29tbW9uLWxpYi9zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbImxvZ2dlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsVUFBVSxFQUFxQixXQUFXLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM3RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2xDLE9BQU8sS0FBSyxPQUFPLE1BQU0sUUFBUSxDQUFDOzs7O0lBQzVCLE1BQU0sR0FBRyxPQUFPO0FBRXRCO0lBR2tDLHdDQUFtQjtJQW9CbkQsc0JBQXNCLElBQWdCO1FBQXRDLFlBQ0Usa0JBQU0sSUFBSSxDQUFDLFNBQ1o7UUFGcUIsVUFBSSxHQUFKLElBQUksQ0FBWTs7Ozs7Ozs7Ozs7O1FBUjVCLGNBQVEsR0FBZ0IsSUFBSSxXQUFXLENBQUM7WUFDaEQsY0FBYyxFQUFFLE1BQU07WUFDdEIsU0FBUyxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUTtZQUNuQyxxQkFBcUIsRUFBRSxNQUFNLENBQUMsUUFBUSxDQUFDLFFBQVE7U0FDaEQsQ0FBQyxDQUFDO1FBRUssU0FBRyxHQUFXLElBQUksQ0FBQzs7SUFJM0IsQ0FBQztJQUVELHNCQUFJLHVDQUFhOzs7O1FBSWpCO1lBQ0UsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBRSxlQUFlLENBQUUsQ0FBQztRQUM5QyxDQUFDOzs7OztRQU5ELFVBQW1CLEVBQVU7WUFDM0IsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBRSxlQUFlLEVBQUUsRUFBRSxDQUFFLENBQUM7UUFDM0QsQ0FBQzs7O09BQUE7SUFNRCxz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ZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cEVycm9yUmVzcG9uc2UsIEh0dHBIZWFkZXJzIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgQWJzdHJhY3RIdHRwU2VydmljZSB9IGZyb20gJy4vYWJzdHJhY3QtYXBpLXNlcnZpY2UnO1xuaW1wb3J0IHsgdGhyb3dFcnJvciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0ICogYXMgbW9tZW50XyBmcm9tICdtb21lbnQnO1xuY29uc3QgbW9tZW50ID0gbW9tZW50XztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgQ29tbW9uTG9nZ2VyIGV4dGVuZHMgQWJzdHJhY3RIdHRwU2VydmljZSB7XG4gIC8qKlxuICAgKiBUaGUgSFRUUCBIZWFkZXJzIHdoaWNoIGdvIHdpdGggZWFjaCByZXF1ZXN0LiAgVGhlc2UgTVVTVCBiZSBzZXQgaWYgeW91IGFyZVxuICAgKiB1c2luZyB0aGUgbG9nZ2VyLiAgRmllbGRzIGluY2x1ZGU6XG4gICAqXG4gICAqIC0gcHJvZ3JhbSAoUkVRVUlSRUQsIHRoZSBhcHBsaWNhdGlvbiB3aWRlIGNvZGUpXG4gICAqIC0gYXBwbGljYXRpb25JZCAoUkVRVUlSRUQsIGxpa2Ugc2Vzc2lvbklkKVxuICAgKiAtIHJlcXVlc3RfbWV0aG9kIChSRVFVSVJFRCwgJ1BPU1QnKVxuICAgKiAtIGxvZ3NvdXJjZTogKFJFUVVJUkVELCB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUpXG4gICAqIC0gaHR0cF94X2ZvcndhcmRlZF9ob3N0IChSRVFVSVJFRCwgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lKVxuICAgKlxuICAgKi9cbiAgcHJvdGVjdGVkIF9oZWFkZXJzOiBIdHRwSGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycyh7XG4gICAgcmVxdWVzdF9tZXRob2Q6ICdQT1NUJyxcbiAgICBsb2dzb3VyY2U6IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSxcbiAgICBodHRwX3hfZm9yd2FyZGVkX2hvc3Q6IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZVxuICB9KTtcblxuICBwcml2YXRlIHVybDogc3RyaW5nID0gbnVsbDtcblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgaHR0cDogSHR0cENsaWVudCkge1xuICAgIHN1cGVyKGh0dHApO1xuICB9XG5cbiAgc2V0IGFwcGxpY2F0aW9uSWQoIGlkOiBzdHJpbmcgKSB7XG4gICAgdGhpcy5faGVhZGVycyA9IHRoaXMuX2hlYWRlcnMuc2V0KCAnYXBwbGljYXRpb25JZCcsIGlkICk7XG4gIH1cblxuICBnZXQgYXBwbGljYXRpb25JZCgpIHtcbiAgICByZXR1cm4gdGhpcy5faGVhZGVycy5nZXQoICdhcHBsaWNhdGlvbklkJyApO1xuICB9XG5cbiAgc2V0IHByb2dyYW1OYW1lKCBuYW1lOiBzdHJpbmcgKSB7XG4gICAgdGhpcy5faGVhZGVycyA9IHRoaXMuX2hlYWRlcnMuc2V0KCAncHJvZ3JhbScsIG5hbWUgKTtcbiAgfVxuXG4gIGdldCBwcm9ncmFtTmFtZSgpIHtcbiAgICByZXR1cm4gdGhpcy5faGVhZGVycy5nZXQoICduYW1lJyApO1xuICB9XG5cbiAgc2V0VVJMKG5ld1VSTDogc3RyaW5nKSB7XG4gICAgdGhpcy51cmwgPSBuZXdVUkw7XG4gIH1cblxuICBwdWJsaWMgbG9nKCBtZXNzYWdlOiBhbnkgKSB7XG4gICAgdGhpcy5fbG9nKCBtZXNzYWdlIGFzIENvbW1vbkxvZ01lc3NhZ2UgKTtcbiAgfVxuXG4gIHB1YmxpYyBsb2dFcnJvciggZXJyb3JNZXNzYWdlOiBhbnkgKSB7XG4gICAgdGhpcy5fbG9nRXJyb3IoIGVycm9yTWVzc2FnZSBhcyBDb21tb25Mb2dNZXNzYWdlICk7XG4gIH1cblxuICAvKipcbiAgICogTG9nIGEgbWVzc2FnZSB0byBTcGx1bmsuIFRoaXMgaXMgdGhlIG1haW4gd2F5IHRvIHNlbmQgbG9ncyBhbmRcbiAgICogYXV0b21hdGljYWxseSBpbmNsdWRlcyBtZXRhLWRhdGEuIFlvdSBkbyAqKm5vdCoqIG5lZWQgdG8gc3Vic2NyaWJlIHRvIHRoZVxuICAgKiByZXNwb25zZSwgYXMgdGhlIHNlcnZpY2UgYWxyZWFkeSBkb2VzIHRoYXQuIFRoZSBpbnB1dCBvYmplY3QgbXVzdCBoYXZlIGFuXG4gICAqICdldmVudCcgcHJvcGVydHkgc2V0LCBldmVyeXRoaW5nIGVsc2UgaXMgb3B0aW9uYWwuXG4gICAqXG4gICAqIEV4YW1wbGU6XG4gICAqIGBgYFxuICAgIHRoaXMubG9nU2VydmljZS5sb2coe1xuICAgICAgIGV2ZW50OiAnc3VibWlzc2lvbicsXG4gICAgICAgZGF0ZU9iajogbmV3IERhdGUoKVxuICAgIH0pO1xuICAgIGBgYFxuICAgKiBAcGFyYW0gbWVzc2FnZSBBIEphdmFTY3JpcHQgb2JqZWN0LCBuZXN0aW5nIGlzIGZpbmUsIHdpdGggYGV2ZW50YCBwcm9wZXJ0eVxuICAgKiBzZXQuXG4gICAqL1xuICBwcm90ZWN0ZWQgX2xvZyhtZXNzYWdlOiBDb21tb25Mb2dNZXNzYWdlKSB7XG4gICAgdGhpcy5zZXRTZXZlcml0eShTZXZlcml0eUxldmVscy5JTkZPKTtcbiAgICByZXR1cm4gdGhpcy5fc2VuZExvZyhtZXNzYWdlKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBfbG9nRXJyb3IoZXJyb3JNZXNzYWdlOiBDb21tb25Mb2dNZXNzYWdlKSB7XG4gICAgdGhpcy5zZXRTZXZlcml0eShTZXZlcml0eUxldmVscy5FUlJPUik7XG4gICAgcmV0dXJuIHRoaXMuX3NlbmRMb2coZXJyb3JNZXNzYWdlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2cgSFRUUCBlcnJvcnMsIGUuZy4gd2hlbiBsb3NpbmcgbmV0d29yayBjb25uZWN0aXZpdHkgb3IgcmVjZWl2aW5nIGFuXG4gICAqIGVycm9yIHJlc3BvbnNlIGNvZGUuXG4gICAqL1xuICBwdWJsaWMgbG9nSHR0cEVycm9yKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkge1xuICAgIHJldHVybiB0aGlzLl9sb2dFcnJvcih7XG4gICAgICBldmVudDogJ2Vycm9yJyxcbiAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICBlcnJvck5hbWU6IGVycm9yLm5hbWUsXG4gICAgICBzdGF0dXNUZXh0OiBlcnJvci5zdGF0dXNUZXh0XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogSW50ZXJuYWwgbWV0aG9kIHRvIHNlbmQgbG9ncyB0byBTcGx1bmssIGluY2x1ZGVzIG1ldGEtZGF0YSBleGNlcHQgdGhhdCdzXG4gICAqIGNvbnNpc3RlbnQgYWNyb3NzIGFsbCByZXF1ZXN0cywgYnV0IG5vdCBzcGVjaWZpYyB2YWx1ZXMgbGlrZSBzZXZlcml0eVxuICAgKiBsZXZlbC5cbiAgICpcbiAgICogQHBhcmFtIG1lc3NhZ2UgQSBKYXZhU2NyaXB0IG9iamVjdCBvciBhbnl0aGluZyB0aGF0IGNhbiBiZSB0b1N0cmluZygpJ2QsXG4gICAqIGxpa2UgRGF0ZVxuICAgKi9cbiAgcHJpdmF0ZSBfc2VuZExvZyhtZXNzYWdlOiBDb21tb25Mb2dNZXNzYWdlKSB7XG4gICAgLy8gVXBkYXRlIGhlYWRlcnNcbiAgICB0aGlzLnNldFRpbWVzdGFtcCgpO1xuICAgIHRoaXMuc2V0VGFncyhtZXNzYWdlLmV2ZW50KTtcblxuICAgIGlmICh0aGlzLnVybCA9PT0gbnVsbCkge1xuICAgICAgICBjb25zdCBtc2cgPSAnVW5hYmxlIHRvIHNlbmQgbG9ncyBhcyBVUkwgYXMgbm90IGJlZW4gc2V0IHZpYSBzZXRVUkwoKSc7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IobXNnKTtcbiAgICAgICAgcmV0dXJuIHRocm93RXJyb3IobXNnKTtcbiAgICB9XG5cbiAgICAvLyBDb25maWd1cmUgcmVxdWVzdFxuICAgIGNvbnN0IGJvZHkgPSB7IG1lc3NhZ2U6IG1lc3NhZ2UgfTtcblxuICAgIC8vIFdlIGNhbGwgLnN1YnNjcmliZSgpIGhlcmUgYmVjYXVzZSB3ZSBkb24ndCBjYXJlIGFib3V0IHRoZSByZXNwb25zZSBhbmRcbiAgICAvLyB3ZSB3YW50IHRvIGVuc3VyZSB0aGF0IHdlIG5ldmVyIGZvcmdldCB0byBjYWxsIHN1YnNjcmliZS5cbiAgICByZXR1cm4gdGhpcy5wb3N0KHRoaXMudXJsLCBib2R5KS5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBoYW5kbGVFcnJvcihlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpIHtcbiAgICBjb25zb2xlLmxvZygnbG9nU2VydmljZSBoYW5kbGVFcnJvcigpJywgZXJyb3IpO1xuICAgIGlmIChlcnJvci5lcnJvciBpbnN0YW5jZW9mIEVycm9yRXZlbnQpIHtcbiAgICAgIC8vIENsaWVudC1zaWRlIC8gbmV0d29yayBlcnJvciBvY2N1cmVkXG4gICAgICBjb25zb2xlLmVycm9yKCdBbiBlcnJvciBvY2N1cmVkOiAnLCBlcnJvci5lcnJvci5tZXNzYWdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVGhlIGJhY2tlbmQgcmV0dXJuZWQgYW4gdW5zdWNjZXNzZnVsIHJlc3BvbnNlIGNvZGVcbiAgICAgIGNvbnNvbGUuZXJyb3IoYEJhY2tlbmQgcmV0dXJuZWQgZXJyb3IgY29kZTogJHtlcnJvci5zdGF0dXN9LiAgRXJyb3IgYm9keTogJHtlcnJvci5lcnJvcn1gKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhyb3dFcnJvcihlcnJvcik7XG4gIH1cblxuICAvKipcbiAgICogT3ZlcndyaXRlIHRoZSBpbmhlcml0ZWQgaHR0cE9wdGlvbnMgc28gd2UgY2FuIHNldCByZXNwb25zZVR5cGUgdG8gdGV4dC5cbiAgICogVGhpcyB1cGRhdGVzIEFuZ3VsYXIncyBwYXJzaW5nLCBhbmQgaXQgd29uJ3QgZXJyb3Igb3V0IGR1ZSB0byB0aGUgc2VydmVyXG4gICAqIG5vdCByZXNwb25kaW5nIHdpdGggSlNPTi5cbiAgICovXG4gIHByb3RlY3RlZCBnZXQgaHR0cE9wdGlvbnMoKTogYW55IHtcbiAgICByZXR1cm4ge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIHJlc3BvbnNlVHlwZTogJ3RleHQnXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0VGltZXN0YW1wKCkge1xuICAgIHRoaXMuX2hlYWRlcnMgPSB0aGlzLl9oZWFkZXJzLnNldCgndGltZXN0YW1wJywgbW9tZW50KCkudG9JU09TdHJpbmcoKSk7XG4gIH1cblxuICBwcml2YXRlIHNldFNldmVyaXR5KHNldmVyaXR5OiBTZXZlcml0eUxldmVscykge1xuICAgIHRoaXMuX2hlYWRlcnMgPSB0aGlzLl9oZWFkZXJzLnNldCgnc2V2ZXJpdHknLCBzZXZlcml0eSk7XG4gIH1cblxuICAvKipcbiAgICogVGhlIGhlYWRlcnMgYXJlIGVhc2llciB0byBzZWFyY2ggaW4gc3BsdW5rLCBhbmQgd2UgYXJlbid0IHVzaW5nIHRhZ3MsIHNvXG4gICAqIHJlcHVycG9zZSBpdCB0byBldmVudCB0eXBlLlxuICAgKi9cbiAgcHJpdmF0ZSBzZXRUYWdzKG1lc3NhZ2U6IHN0cmluZyApIHtcbiAgICB0aGlzLl9oZWFkZXJzID0gdGhpcy5faGVhZGVycy5zZXQoJ3RhZ3MnLCBtZXNzYWdlKTtcbiAgfVxuXG59XG5cbmVudW0gU2V2ZXJpdHlMZXZlbHMge1xuICBJTkZPID0gJ2luZm8nLFxuICBFUlJPUiA9ICdlcnJvcicsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tbW9uTG9nTWVzc2FnZSB7XG4gIC8qKiBUaGUgdHlwZSBvZiBldmVudCBiZWluZyBsb2dnZWQuICovXG4gIGV2ZW50OiBzdHJpbmc7IC8vIFNob3VsZCBiZSBzdWJjbGFzc2VzIGludG8gbXVsdGlwbGUgc3RyaW5nIGxpdGVyYWxzXG4gIC8vIFdlIGFsbG93IGFueSBvdGhlciBwcm9wZXJ0aWVzL3ZhbHVlcyBpbiB0aGUgaW50ZXJmYWNlXG4gIFtrZXk6IHN0cmluZ106IGFueTtcbn1cbiJdfQ==