/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, ViewChild, NgZone, ChangeDetectorRef, Output, Input, EventEmitter } from '@angular/core';
import { CaptchaDataService } from './captcha-data.service';
var CaptchaComponent = /** @class */ (function () {
    function CaptchaComponent(dataService, cd, ngZone) {
        this.dataService = dataService;
        this.cd = cd;
        this.ngZone = ngZone;
        // tslint:disable-next-line:no-output-on-prefix
        this.onValidToken = new EventEmitter();
        this.language = 'en';
        /**
         * Http error response for fetching a CAPTCHA image.
         */
        this.errorFetchingImg = null;
        /**
         * Http error response for verifying user's answer.
         */
        this.errorVerifyAnswer = null;
        this.validation = '';
        this.audio = '';
        this.answer = '';
        this.fetchingAudioInProgress = false;
        // tslint:disable-next-line:member-ordering
        this.translatedMessages = {
            playAudio: {
                en: 'Play Audio',
                zh: '播放声音',
                fr: 'Lecture audio',
                pa: 'ਆਡੀਓ ਚਲਾਓ',
            },
            tryAnotherImg: {
                en: 'Try another image',
                zh: '换个图像',
                fr: 'Essayez une autre image',
                pa: 'ਕੋਈ ਹੋਰ ਚਿੱਤਰ ਅਜ਼ਮਾਓ',
            },
            userPromptMessage: {
                en: 'Enter the text you either see in the box or you hear in the audio',
                zh: '请输入看到或听到的文字',
                fr: 'Entrez le texte que vous voyez dans la case ou que vous entendez dans le son',
                pa: 'ਉਹ ਟੈਕਸਟ ਦਾਖਲ ਕਰੋ ਜੋ ਤੁਸੀਂ ਬਕਸੇ ਵਿੱਚ ਦੇਖਦੇ ਹੋ ਜਾਂ ਤੁਸੀਂ ਆਡੀਓ ਵਿੱਚ ਸੁਣਦੇ ਹੋ',
            },
            incorrectAnswer: {
                en: 'Incorrect answer, please try again.',
                zh: '答案不对。请重试。',
                fr: 'Mauvaise réponse, veuillez réessayer.',
                pa: 'ਗਲਤ ਜਵਾਬ, ਕਿਰਪਾ ਕਰਕੇ ਦੁਬਾਰਾ ਕੋਸ਼ਿਸ਼ ਕਰੋ.',
            },
            successMessage: {
                en: 'You can submit your application now.',
                zh: '你现在可以提交申请了。',
                fr: 'Vous pouvez soumettre votre candidature maintenant.',
                pa: 'ਤੁਸੀਂ ਆਪਣੀ ਅਰਜ਼ੀ ਹੁਣੇ ਪੇਸ਼ ਕਰ ਸਕਦੇ ਹੋ',
            },
            correct: {
                en: 'Correct.',
                zh: '正确。',
                fr: 'Correct.',
                pa: 'ਸਹੀ ਕਰੋ',
            },
            loadingImage: {
                en: 'Loading CAPTCHA image',
                zh: '正在下载验证码',
                fr: 'Chargement de l\'image CAPTCHA',
                pa: 'ਕੈਪਟਚਾ ਚਿੱਤਰ ਲੋਡ ਕਰ ਰਿਹਾ ਹੈ',
            },
            browserNotSupportAudio: {
                en: 'Your browser does not support the audio element.',
                zh: '你的浏览器不支持播音',
                fr: 'Votre navigateur ne supporte pas l\'élément audio.',
                pa: 'ਤੁਹਾਡਾ ਬ੍ਰਾਉਜ਼ਰ ਆਡੀਓ ਐਲੀਮੈਂਟ ਦਾ ਸਮਰਥਨ ਨਹੀਂ ਕਰਦਾ.',
            },
            verifyingAnswer: {
                en: 'Verifying your answer...',
                zh: '正在验证答案...',
                fr: 'Vérification de votre réponse ...',
                pa: 'ਤੁਹਾਡਾ ਜਵਾਬ ਤਸਦੀਕ ਕਰ ਰਿਹਾ ਹੈ ...',
            },
            errorRetrievingImg: {
                en: 'Error happened while retrieving CAPTCHA image. please {{click here}} to try again',
                zh: '验证码下载错误。请{{点击这里}}重试',
                fr: 'Une erreur s\'est produite lors de la récupération de l\'image CAPTCHA. s\'il vous plaît {{cliquez ici}} pour réessayer',
                pa: 'ਕੈਪਟਚਾ ਚਿੱਤਰ ਨੂੰ ਪ੍ਰਾਪਤ ਕਰਦੇ ਸਮੇਂ ਤਰੁੱਟੀ ਉਤਪੰਨ ਹੋਈ. ਕਿਰਪਾ ਕਰਕੇ ਦੁਬਾਰਾ ਕੋਸ਼ਿਸ਼ ਕਰਨ ਲਈ {{ਇੱਥੇ ਕਲਿਕ ਕਰੋ}}',
            },
            errorVerifyingAnswer: {
                en: 'Error happened while verifying your answer. please {{click here}} to try again',
                zh: '验证答案过程发生错误。请{{点击这里}}重试',
                fr: 'Une erreur s\'est produite lors de la vérification de votre réponse. s\'il vous plaît {{cliquez ici}} pour réessayer',
                pa: 'ਤੁਹਾਡਾ ਜਵਾਬ ਤਸਦੀਕ ਕਰਨ ਵੇਲੇ ਗਲਤੀ ਆਈ ਕਿਰਪਾ ਕਰਕੇ ਦੁਬਾਰਾ ਕੋਸ਼ਿਸ਼ ਕਰਨ ਲਈ {{ਇੱਥੇ ਕਲਿਕ ਕਰੋ}}',
            },
        };
    }
    /**
     * @return {?}
     */
    CaptchaComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.forceRefresh.bind(this);
        window['ca.bcgov.captchaRefresh'] = this.publicForceRefresh.bind(this);
        // if(!this.userPromptMessage){
        //   this.userPromptMessage = "Enter the text you either see in the box or you hear in the audio";
        // }
    };
    /**
     * @return {?}
     */
    CaptchaComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.forceRefresh();
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    CaptchaComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        // when changing language, if audio is empty then no need to refetch
        if (!changes.language || !this.audio || this.audio.length === 0) {
            if (!(changes.reloadCaptcha && (true === changes.reloadCaptcha.previousValue
                || false === changes.reloadCaptcha.previousValue)
                && (changes.reloadCaptcha.currentValue !== changes.reloadCaptcha.previousValue))) {
                return;
            }
        }
        this.getNewCaptcha(false);
    };
    /**
     * @return {?}
     */
    CaptchaComponent.prototype.forceRefresh = /**
     * @return {?}
     */
    function () {
        this.getNewCaptcha(false);
        this.cd.detectChanges();
    };
    /**
     * @return {?}
     */
    CaptchaComponent.prototype.publicForceRefresh = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.ngZone.run((/**
         * @return {?}
         */
        function () { return _this.forceRefresh(); }));
    };
    /**
     * @param {?} event
     * @return {?}
     */
    CaptchaComponent.prototype.answerChanged = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        if (this.answer.length < 6) {
            this.incorrectAnswer = null;
        }
        if (this.answer.length === 6) {
            this.state = CAPTCHA_STATE.VERIFYING_ANSWER;
            this.incorrectAnswer = null;
            this.dataService.verifyCaptcha(this.apiBaseUrl, this.nonce, this.answer, this.validation).subscribe((/**
             * @param {?} response
             * @return {?}
             */
            function (response) {
                /** @type {?} */
                var payload = response.body;
                if (_this.isValidPayload(payload)) {
                    _this.handleVerify(payload);
                }
                else {
                    _this.state = CAPTCHA_STATE.ERROR_VERIFY;
                    _this.errorVerifyAnswer = _this.createErrorTextLine(response);
                }
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                _this.state = CAPTCHA_STATE.ERROR_VERIFY;
                _this.errorVerifyAnswer = _this.createErrorTextLine(error);
                console.log('Error response from verifying user answer: %o', error);
            }));
        }
    };
    // Call the backend to see if our answer is correct
    // Call the backend to see if our answer is correct
    /**
     * @private
     * @param {?} payload
     * @return {?}
     */
    CaptchaComponent.prototype.handleVerify = 
    // Call the backend to see if our answer is correct
    /**
     * @private
     * @param {?} payload
     * @return {?}
     */
    function (payload) {
        // There could be the rare change where an invalid payload response is received.
        if (payload.valid === true) {
            this.state = CAPTCHA_STATE.SUCCESS_VERIFY_ANSWER_CORRECT;
            this.onValidToken.emit(payload.jwt);
        }
        else {
            this.incorrectAnswer = true;
            this.answer = '';
            this.audio = '';
            // They failed - try a new one.
            this.getNewCaptcha(true);
        }
    };
    /**
     * Case where HTTP 200 response code is received by the payload is incorrect or corrupt.
     * The occurance of this type of case should be rare.
     * @param payload
     */
    /**
     * Case where HTTP 200 response code is received by the payload is incorrect or corrupt.
     * The occurance of this type of case should be rare.
     * @private
     * @param {?} payload
     * @return {?}
     */
    CaptchaComponent.prototype.isValidPayload = /**
     * Case where HTTP 200 response code is received by the payload is incorrect or corrupt.
     * The occurance of this type of case should be rare.
     * @private
     * @param {?} payload
     * @return {?}
     */
    function (payload) {
        // console.debug('Response payload: %o', payload);
        if (!payload) {
            console.error('payload cannot be null or undefined or 0');
            return false;
        }
        else {
            /** @type {?} */
            var hasValueProp = payload.hasOwnProperty('valid');
            if (!hasValueProp) {
                console.error('payload must have its own property named \'valid\'');
                return false;
            }
            else {
                return true;
            }
        }
    };
    /**
     * @return {?}
     */
    CaptchaComponent.prototype.retryFetchCaptcha = /**
     * @return {?}
     */
    function () {
        var _this = this;
        console.log('Retry captcha');
        this.state = undefined;
        /**
         * wait for 0.5 seond before resubmitting
         */
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this.getNewCaptcha(false);
        }), 100);
    };
    /**
     * @return {?}
     */
    CaptchaComponent.prototype.playAudio = /**
     * @return {?}
     */
    function () {
        if (this.audio && this.audio.length > 0) {
            this.audioElement.nativeElement.play();
        }
        else {
            this.fetchAudio(true);
        }
    };
    /**
     * @private
     * @param {?=} playImmediately
     * @return {?}
     */
    CaptchaComponent.prototype.fetchAudio = /**
     * @private
     * @param {?=} playImmediately
     * @return {?}
     */
    function (playImmediately) {
        var _this = this;
        if (playImmediately === void 0) { playImmediately = false; }
        if (!this.fetchingAudioInProgress) {
            this.fetchingAudioInProgress = true;
            this.dataService.fetchAudio(this.apiBaseUrl, this.validation, this.language).subscribe((/**
             * @param {?} response
             * @return {?}
             */
            function (response) {
                _this.fetchingAudioInProgress = false;
                _this.audio = response.body.audio;
                _this.cd.detectChanges();
                if (playImmediately) {
                    _this.audioElement.nativeElement.play();
                }
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                _this.fetchingAudioInProgress = false;
                console.log('Error response from fetching audio CAPTCHA: %o', error);
                _this.cd.detectChanges();
            }));
        }
    };
    /**
     * @param {?} errorCase
     * @return {?}
     */
    CaptchaComponent.prototype.getNewCaptcha = /**
     * @param {?} errorCase
     * @return {?}
     */
    function (errorCase) {
        var _this = this;
        this.state = CAPTCHA_STATE.FETCHING_CAPTCHA_IMG;
        this.audio = '';
        // Reset things
        if (!errorCase) {
            // Let them know they failed instead of wiping out the answer area
            // Contructing this form on page load/reload will have errorCase = false
            this.incorrectAnswer = null;
        }
        this.dataService.fetchData(this.apiBaseUrl, this.nonce).subscribe((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            _this.state = CAPTCHA_STATE.SUCCESS_FETCH_IMG;
            /** @type {?} */
            var payload = response.body;
            _this.imageContainer.nativeElement.innerHTML = payload.captcha;
            _this.validation = payload.validation;
            _this.cd.detectChanges();
            if (_this.eagerFetchAudio === 'true') {
                // console.log('Fetch audio eagerly');
                _this.fetchAudio();
            }
            else {
                // console.log('Not to fetch audio eagerly');
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            _this.state = CAPTCHA_STATE.ERROR_FETCH_IMG;
            _this.errorFetchingImg = _this.createErrorTextLine(error);
            console.log('Error esponse from fetching CAPTCHA text: %o', error);
            _this.cd.detectChanges();
        }));
    };
    /**
     * @private
     * @param {?} error
     * @return {?}
     */
    CaptchaComponent.prototype.createErrorTextLine = /**
     * @private
     * @param {?} error
     * @return {?}
     */
    function (error) {
        /** @type {?} */
        var line = 'Error status: ' + error.status;
        if (error.statusText) {
            line = line + ', status text: ' + error.statusText;
        }
        return line;
    };
    CaptchaComponent.decorators = [
        { type: Component, args: [{
                    selector: 'common-captcha',
                    template: "<div class=\"bcgov-captcha\">\n\n\n  <svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n    <defs>\n        <symbol id=\"icon-play-def\" viewBox=\"0 0 32 32\">\n            <path d=\"M16 0c-8.837 0-16 7.163-16 16s7.163 16 16 16 16-7.163 16-16-7.163-16-16-16zM16 29c-7.18 0-13-5.82-13-13s5.82-13 13-13 13 5.82 13 13-5.82 13-13 13zM12 9l12 7-12 7z\"></path>\n        </symbol>  \n\n        <symbol id=\"icon-loop-def\" viewBox=\"0 0 32 32\">\n          <path d=\"M27.802 5.197c-2.925-3.194-7.13-5.197-11.803-5.197-8.837 0-16 7.163-16 16h3c0-7.18 5.82-13 13-13 3.844 0 7.298 1.669 9.678 4.322l-4.678 4.678h11v-11l-4.198 4.197z\"></path>\n          <path d=\"M29 16c0 7.18-5.82 13-13 13-3.844 0-7.298-1.669-9.678-4.322l4.678-4.678h-11v11l4.197-4.197c2.925 3.194 7.13 5.197 11.803 5.197 8.837 0 16-7.163 16-16h-3z\"></path>\n        </symbol>  \n        \n        <symbol id=\"icon-check-def\" viewBox=\"0 0 24 24\">\n          <path d=\"M9 16.172l10.594-10.594 1.406 1.406-12 12-5.578-5.578 1.406-1.406z\"></path>\n        </symbol>    \n        \n        <symbol id=\"icon-exclamation-triangle-def\" viewBox=\"0 0 28 28\">\n            <path d=\"M16 21.484v-2.969c0-0.281-0.219-0.516-0.5-0.516h-3c-0.281 0-0.5 0.234-0.5 0.516v2.969c0 0.281 0.219 0.516 0.5 0.516h3c0.281 0 0.5-0.234 0.5-0.516zM15.969 15.641l0.281-7.172c0-0.094-0.047-0.219-0.156-0.297-0.094-0.078-0.234-0.172-0.375-0.172h-3.437c-0.141 0-0.281 0.094-0.375 0.172-0.109 0.078-0.156 0.234-0.156 0.328l0.266 7.141c0 0.203 0.234 0.359 0.531 0.359h2.891c0.281 0 0.516-0.156 0.531-0.359zM15.75 1.047l12 22c0.344 0.609 0.328 1.359-0.031 1.969s-1.016 0.984-1.719 0.984h-24c-0.703 0-1.359-0.375-1.719-0.984s-0.375-1.359-0.031-1.969l12-22c0.344-0.641 1.016-1.047 1.75-1.047s1.406 0.406 1.75 1.047z\"></path>\n        </symbol>\n        \n    </defs>\n  </svg>\n\n\n\n  <form style=\"clear:both\" #formRef=\"ngForm\">\n    <div [ngClass]=\"{'has-error': !!incorrectAnswer}\">\n      <div>\n        \n        <div class=\"spinner-box\" *ngIf=\"!state || state === 1\">\n         <div style=\"float:left; margin: 2px 0 1px 8px\">\n            <svg class=\"lds-spinner\" width=\"45px\"  height=\"45px\"  xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"xMidYMid\" style=\"background: none;\"><g transform=\"rotate(0 50 50)\">\n                <rect x=\"47\" y=\"22\" rx=\"9.4\" ry=\"4.4\" width=\"6\" height=\"16\" fill=\"#1d3f72\">\n                  <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.8888888888888888s\" repeatCount=\"indefinite\"></animate>\n                </rect>\n              </g><g transform=\"rotate(40 50 50)\">\n                <rect x=\"47\" y=\"22\" rx=\"9.4\" ry=\"4.4\" width=\"6\" height=\"16\" fill=\"#1d3f72\">\n                  <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.7777777777777778s\" repeatCount=\"indefinite\"></animate>\n                </rect>\n              </g><g transform=\"rotate(80 50 50)\">\n                <rect x=\"47\" y=\"22\" rx=\"9.4\" ry=\"4.4\" width=\"6\" height=\"16\" fill=\"#1d3f72\">\n                  <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.6666666666666666s\" repeatCount=\"indefinite\"></animate>\n                </rect>\n              </g><g transform=\"rotate(120 50 50)\">\n                <rect x=\"47\" y=\"22\" rx=\"9.4\" ry=\"4.4\" width=\"6\" height=\"16\" fill=\"#1d3f72\">\n                  <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.5555555555555556s\" repeatCount=\"indefinite\"></animate>\n                </rect>\n              </g><g transform=\"rotate(160 50 50)\">\n                <rect x=\"47\" y=\"22\" rx=\"9.4\" ry=\"4.4\" width=\"6\" height=\"16\" fill=\"#1d3f72\">\n                  <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.4444444444444444s\" repeatCount=\"indefinite\"></animate>\n                </rect>\n              </g><g transform=\"rotate(200 50 50)\">\n                <rect x=\"47\" y=\"22\" rx=\"9.4\" ry=\"4.4\" width=\"6\" height=\"16\" fill=\"#1d3f72\">\n                  <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.3333333333333333s\" repeatCount=\"indefinite\"></animate>\n                </rect>\n              </g><g transform=\"rotate(240 50 50)\">\n                <rect x=\"47\" y=\"22\" rx=\"9.4\" ry=\"4.4\" width=\"6\" height=\"16\" fill=\"#1d3f72\">\n                  <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.2222222222222222s\" repeatCount=\"indefinite\"></animate>\n                </rect>\n              </g><g transform=\"rotate(280 50 50)\">\n                <rect x=\"47\" y=\"22\" rx=\"9.4\" ry=\"4.4\" width=\"6\" height=\"16\" fill=\"#1d3f72\">\n                  <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.1111111111111111s\" repeatCount=\"indefinite\"></animate>\n                </rect>\n              </g><g transform=\"rotate(320 50 50)\">\n                <rect x=\"47\" y=\"22\" rx=\"9.4\" ry=\"4.4\" width=\"6\" height=\"16\" fill=\"#1d3f72\">\n                  <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"0s\" repeatCount=\"indefinite\"></animate>\n                </rect>\n              </g></svg>\n         </div>\n         <div style=\"float:left; margin: 16px 0 1px 3px\">\n            {{translatedMessages.loadingImage[language]}}\n         </div>\n         <div style=\"clear:both\"></div>\n        </div>\n        \n        <div [ngClass]=\"{'captcha-box-visible': state === 2, 'captcha-box-invisible': state !== 2}\">\n          <div>\n            <div style=\"float: left;\" #image class=\"captcha-image\"></div>\n            <audio #audioElement *ngIf=\"audio && audio.length > 0\" id=\"audioElement\" [src]=\"audio\">\n                {{translatedMessages.browserNotSupportAudio[language]}}\n            </audio>\n            <div style=\"float: left; margin-top: 8px\">\n              <a class=\"play-audio\" href=\"javascript:void(0)\" (click)=\"playAudio()\" role=\"button\">\n                <svg *ngIf=\"!fetchingAudioInProgress\" class=\"icon-play\"><use xlink:href=\"#icon-play-def\"></use></svg>\n                \n                <svg *ngIf=\"fetchingAudioInProgress\" class=\"lds-spinner\" width=\"15px\"  height=\"15px\"  xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"xMidYMid\" style=\"background: none;\"><g transform=\"rotate(0 50 50)\">\n                  <rect x=\"45\" y=\"9\" rx=\"2.7\" ry=\"0.54\" width=\"10\" height=\"22\" fill=\"#1d3f72\">\n                    <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.8888888888888888s\" repeatCount=\"indefinite\"></animate>\n                  </rect>\n                </g><g transform=\"rotate(40 50 50)\">\n                  <rect x=\"45\" y=\"9\" rx=\"2.7\" ry=\"0.54\" width=\"10\" height=\"22\" fill=\"#1d3f72\">\n                    <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.7777777777777778s\" repeatCount=\"indefinite\"></animate>\n                  </rect>\n                </g><g transform=\"rotate(80 50 50)\">\n                  <rect x=\"45\" y=\"9\" rx=\"2.7\" ry=\"0.54\" width=\"10\" height=\"22\" fill=\"#1d3f72\">\n                    <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.6666666666666666s\" repeatCount=\"indefinite\"></animate>\n                  </rect>\n                </g><g transform=\"rotate(120 50 50)\">\n                  <rect x=\"45\" y=\"9\" rx=\"2.7\" ry=\"0.54\" width=\"10\" height=\"22\" fill=\"#1d3f72\">\n                    <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.5555555555555556s\" repeatCount=\"indefinite\"></animate>\n                  </rect>\n                </g><g transform=\"rotate(160 50 50)\">\n                  <rect x=\"45\" y=\"9\" rx=\"2.7\" ry=\"0.54\" width=\"10\" height=\"22\" fill=\"#1d3f72\">\n                    <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.4444444444444444s\" repeatCount=\"indefinite\"></animate>\n                  </rect>\n                </g><g transform=\"rotate(200 50 50)\">\n                  <rect x=\"45\" y=\"9\" rx=\"2.7\" ry=\"0.54\" width=\"10\" height=\"22\" fill=\"#1d3f72\">\n                    <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.3333333333333333s\" repeatCount=\"indefinite\"></animate>\n                  </rect>\n                </g><g transform=\"rotate(240 50 50)\">\n                  <rect x=\"45\" y=\"9\" rx=\"2.7\" ry=\"0.54\" width=\"10\" height=\"22\" fill=\"#1d3f72\">\n                    <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.2222222222222222s\" repeatCount=\"indefinite\"></animate>\n                  </rect>\n                </g><g transform=\"rotate(280 50 50)\">\n                  <rect x=\"45\" y=\"9\" rx=\"2.7\" ry=\"0.54\" width=\"10\" height=\"22\" fill=\"#1d3f72\">\n                    <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.1111111111111111s\" repeatCount=\"indefinite\"></animate>\n                  </rect>\n                </g><g transform=\"rotate(320 50 50)\">\n                  <rect x=\"45\" y=\"9\" rx=\"2.7\" ry=\"0.54\" width=\"10\" height=\"22\" fill=\"#1d3f72\">\n                    <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"0s\" repeatCount=\"indefinite\"></animate>\n                  </rect>\n                </g></svg>\n\n                {{translatedMessages.playAudio[language]}}\n              </a>\n              <div style=\"clear:both;\"></div>\n              \n              <a class=\"try-another-image\" href=\"javascript:void(0)\" (click)=\"retryFetchCaptcha()\" role=\"button\">\n                  <svg class=\"icon-loop icon-loop-def\"><use xlink:href=\"#icon-loop-def\"></use></svg>                \n                  {{translatedMessages.tryAnotherImg[language]}}\n              </a>\n            </div>\n          </div>\n          <div style=\"clear:both; margin-bottom: 8px;\"></div>\n          <div style=\"float:left;\">\n            <label for=\"answer\">\n                {{userPromptMessage || translatedMessages.userPromptMessage[language]}}\n              <input id=\"answer\" type=\"text\"\n                #userAnswerRef = \"ngModel\"\n                [(ngModel)]=\"answer\"\n                (input)=\"answerChanged($event)\"\n                [ngClass]=\"{'captcha-wrong-answer': userAnswerRef.dirty && incorrectAnswer}\"\n                name=\"answer\"\n                maxlength=\"6\"\n                required\n                autocorrect=\"off\" \n                autocapitalize=\"none\">\n            </label>\n          </div>\n        </div>\n        <div style=\"clear:both;\"></div>\n        <div style=\"float:left;\">\n\n        <div class=\"error-captcha\" *ngIf=\"state === 3\" role=\"alert\" aria-live=\"assertive\">\n          <div style=\"float:left; margin-left: 5px;\">\n            <svg class=\"icon-exclamation-triangle\"><use xlink:href=\"#icon-exclamation-triangle-def\"></use></svg>\n  \n            <span> {{translatedMessages.errorRetrievingImg[language].substring(0,translatedMessages.errorRetrievingImg[language].indexOf('{'))}} \n              <a href=\"javascript:void(0)\" (click)=\"retryFetchCaptcha()\">{{translatedMessages.errorRetrievingImg[language].substring(translatedMessages.errorRetrievingImg[language].lastIndexOf('{')+1,translatedMessages.errorRetrievingImg[language].indexOf('}'))}}</a> \n              {{translatedMessages.errorRetrievingImg[language].substring(translatedMessages.errorRetrievingImg[language].lastIndexOf('}')+1)}} \n            </span>\n          </div>\n          <div style=\"clear:both\"></div>\n          \n          <div style=\"float:left; margin-left: 25px;\">\n              {{errorFetchingImg}}\n          </div>\n          <div style=\"clear:both\"></div>\n        </div>\n        \n        <div class=\"spinner-box\" *ngIf=\"state == 4\" role=\"alert\" aria-live=\"assertive\">\n          <span>{{translatedMessages.verifyingAnswer[language]}}</span>\n        </div>\n        <div class=\"error-captcha\" *ngIf=\"state === 6\"  role=\"alert\" aria-live=\"assertive\">\n          <svg class=\"icon-exclamation-triangle\"><use xlink:href=\"#icon-exclamation-triangle-def\"></use></svg>\n          <span>{{translatedMessages.errorVerifyingAnswer[language].substring(0,translatedMessages.errorVerifyingAnswer[language].indexOf('{'))}} \n              <a href=\"javascript:void(0)\" (click)=\"retryFetchCaptcha()\">{{translatedMessages.errorVerifyingAnswer[language].substring(translatedMessages.errorVerifyingAnswer[language].lastIndexOf('{')+1,translatedMessages.errorVerifyingAnswer[language].indexOf('}'))}}</a> \n              {{translatedMessages.errorVerifyingAnswer[language].substring(translatedMessages.errorVerifyingAnswer[language].lastIndexOf('}')+1)}} \n          </span>\n          <p>\n          </p>\n        </div>\n        \n        <div class=\"captcha-error\" style=\"margin-top: 2px\" *ngIf=\"incorrectAnswer === true\" role=\"alert\" aria-live=\"assertive\">\n          {{translatedMessages.incorrectAnswer[language]}}\n        </div>\n      </div>\n      \n      </div>\n    </div>\n  </form>\n\n  <div class=\"confirm-correct-answer\" style=\"float:left\" *ngIf=\"state === 5\" role=\"alert\" aria-live=\"assertive\">\n    <svg class=\"icon-check\"><use xlink:href=\"#icon-check-def\"></use></svg>\n    {{translatedMessages.correct[language]}} <span>{{successMessage || translatedMessages.successMessage[language]}}</span>\n  </div>\n  <div style=\"clear:both;\"></div>\n</div>\n",
                    styles: [".bcgov-captcha .confirm-correct-answer{display:block;color:green}.bcgov-captcha .confirm-correct-answer i{color:green}.bcgov-captcha .spinner-box{height:60px;margin:2px 10px 6px;padding:5px 10px 5px 18px}.bcgov-captcha .error-captcha{margin-left:10px}.bcgov-captcha .error-captcha svg{color:#ff8c00}.bcgov-captcha .error-captcha p{margin-left:32px}.bcgov-captcha .captcha-box-visible{display:block}.bcgov-captcha .captcha-box-invisible{display:none}.bcgov-captcha .captcha-image{display:inline-block;border:1px solid gray}.bcgov-captcha .play-audio{float:left;display:block;margin-left:5px;margin-bottom:3px}.bcgov-captcha .try-another-image{display:inline-block;margin-left:5px}.bcgov-captcha .has-error{border-color:#dc3545}.bcgov-captcha .has-error:focus{box-shadow:0 0 0 .2rem rgba(220,53,69,.25)}.bcgov-captcha input[type=text]{display:block;margin:0;width:100%;font-size:20px;box-shadow:none;border-radius:none;padding:6px;border:1px solid #ccc;transition:box-shadow .3s,border .3s}.bcgov-captcha input[type=text]:focus{border:1px solid #fff;box-shadow:0 0 1px 1px #2196f3;outline:0}.bcgov-captcha input[type=text].captcha-wrong-answer{border:1px solid #a94442}.bcgov-captcha .captcha-error{color:#a94442}.bcgov-captcha .icon-check,.bcgov-captcha .icon-exclamation-triangle,.bcgov-captcha .icon-loop,.bcgov-captcha .icon-play{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor}.bcgov-captcha .spinner{-webkit-animation:1.4s linear infinite rotator;animation:1.4s linear infinite rotator}@-webkit-keyframes rotator{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(270deg);transform:rotate(270deg)}}@keyframes rotator{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(270deg);transform:rotate(270deg)}}.bcgov-captcha .path{stroke-dasharray:187;stroke-dashoffset:0;-webkit-transform-origin:center;transform-origin:center;-webkit-animation:1.4s ease-in-out infinite dash,5.6s ease-in-out infinite colors;animation:1.4s ease-in-out infinite dash,5.6s ease-in-out infinite colors}@-webkit-keyframes colors{0%{stroke:#9e9e9e}25%{stroke:#757575}50%{stroke:#616161}75%{stroke:#424242}100%{stroke:#212121}}@keyframes colors{0%{stroke:#9e9e9e}25%{stroke:#757575}50%{stroke:#616161}75%{stroke:#424242}100%{stroke:#212121}}@-webkit-keyframes dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;-webkit-transform:rotate(135deg);transform:rotate(135deg)}100%{stroke-dashoffset:187;-webkit-transform:rotate(450deg);transform:rotate(450deg)}}@keyframes dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;-webkit-transform:rotate(135deg);transform:rotate(135deg)}100%{stroke-dashoffset:187;-webkit-transform:rotate(450deg);transform:rotate(450deg)}}"]
                }] }
    ];
    /** @nocollapse */
    CaptchaComponent.ctorParameters = function () { return [
        { type: CaptchaDataService },
        { type: ChangeDetectorRef },
        { type: NgZone }
    ]; };
    CaptchaComponent.propDecorators = {
        imageContainer: [{ type: ViewChild, args: ['image',] }],
        audioElement: [{ type: ViewChild, args: ['audioElement',] }],
        apiBaseUrl: [{ type: Input, args: ['apiBaseUrl',] }],
        nonce: [{ type: Input, args: ['nonce',] }],
        onValidToken: [{ type: Output }],
        successMessage: [{ type: Input, args: ['successMessage',] }],
        eagerFetchAudio: [{ type: Input, args: ['eagerFetchAudio',] }],
        language: [{ type: Input, args: ['language',] }],
        userPromptMessage: [{ type: Input, args: ['userPromptMessage',] }]
    };
    return CaptchaComponent;
}());
export { CaptchaComponent };
if (false) {
    /** @type {?} */
    CaptchaComponent.prototype.imageContainer;
    /** @type {?} */
    CaptchaComponent.prototype.audioElement;
    /** @type {?} */
    CaptchaComponent.prototype.apiBaseUrl;
    /** @type {?} */
    CaptchaComponent.prototype.nonce;
    /** @type {?} */
    CaptchaComponent.prototype.onValidToken;
    /** @type {?} */
    CaptchaComponent.prototype.successMessage;
    /** @type {?} */
    CaptchaComponent.prototype.eagerFetchAudio;
    /** @type {?} */
    CaptchaComponent.prototype.language;
    /** @type {?} */
    CaptchaComponent.prototype.userPromptMessage;
    /**
     * Http error response for fetching a CAPTCHA image.
     * @type {?}
     */
    CaptchaComponent.prototype.errorFetchingImg;
    /**
     * Http error response for verifying user's answer.
     * @type {?}
     */
    CaptchaComponent.prototype.errorVerifyAnswer;
    /**
     * @type {?}
     * @private
     */
    CaptchaComponent.prototype.validation;
    /** @type {?} */
    CaptchaComponent.prototype.audio;
    /** @type {?} */
    CaptchaComponent.prototype.answer;
    /** @type {?} */
    CaptchaComponent.prototype.state;
    /** @type {?} */
    CaptchaComponent.prototype.incorrectAnswer;
    /** @type {?} */
    CaptchaComponent.prototype.fetchingAudioInProgress;
    /** @type {?} */
    CaptchaComponent.prototype.translatedMessages;
    /**
     * @type {?}
     * @private
     */
    CaptchaComponent.prototype.dataService;
    /**
     * @type {?}
     * @private
     */
    CaptchaComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    CaptchaComponent.prototype.ngZone;
}
/** @enum {number} */
var CAPTCHA_STATE = {
    FETCHING_CAPTCHA_IMG: 1,
    SUCCESS_FETCH_IMG: 2,
    ERROR_FETCH_IMG: 3,
    VERIFYING_ANSWER: 4,
    SUCCESS_VERIFY_ANSWER_CORRECT: 5,
    // http error during verification call.
    ERROR_VERIFY: 6,
};
CAPTCHA_STATE[CAPTCHA_STATE.FETCHING_CAPTCHA_IMG] = 'FETCHING_CAPTCHA_IMG';
CAPTCHA_STATE[CAPTCHA_STATE.SUCCESS_FETCH_IMG] = 'SUCCESS_FETCH_IMG';
CAPTCHA_STATE[CAPTCHA_STATE.ERROR_FETCH_IMG] = 'ERROR_FETCH_IMG';
CAPTCHA_STATE[CAPTCHA_STATE.VERIFYING_ANSWER] = 'VERIFYING_ANSWER';
CAPTCHA_STATE[CAPTCHA_STATE.SUCCESS_VERIFY_ANSWER_CORRECT] = 'SUCCESS_VERIFY_ANSWER_CORRECT';
CAPTCHA_STATE[CAPTCHA_STATE.ERROR_VERIFY] = 'ERROR_VERIFY';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FwdGNoYS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9tb2gtY29tbW9uLWxpYi9jYXB0Y2hhLyIsInNvdXJjZXMiOlsiY2FwdGNoYS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBaUIsTUFBTSxFQUN2RCxpQkFBaUIsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFvQyxZQUFZLEVBQ2pGLE1BQU0sZUFBZSxDQUFDO0FBR3ZCLE9BQU8sRUFBRSxrQkFBa0IsRUFBaUIsTUFBTSx3QkFBd0IsQ0FBQztBQUUzRTtJQXNDRSwwQkFBb0IsV0FBK0IsRUFDekMsRUFBcUIsRUFDckIsTUFBYztRQUZKLGdCQUFXLEdBQVgsV0FBVyxDQUFvQjtRQUN6QyxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUNyQixXQUFNLEdBQU4sTUFBTSxDQUFROztRQTNCZCxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7UUFHakMsYUFBUSxHQUFXLElBQUksQ0FBQzs7OztRQU0zQyxxQkFBZ0IsR0FBRyxJQUFJLENBQUM7Ozs7UUFLeEIsc0JBQWlCLEdBQUcsSUFBSSxDQUFDO1FBRWpCLGVBQVUsR0FBRyxFQUFFLENBQUM7UUFDakIsVUFBSyxHQUFHLEVBQUUsQ0FBQztRQUNYLFdBQU0sR0FBRyxFQUFFLENBQUM7UUFLWiw0QkFBdUIsR0FBRyxLQUFLLENBQUM7O1FBMkxoQyx1QkFBa0IsR0FBRztZQUMxQixTQUFTLEVBQUU7Z0JBQ1QsRUFBRSxFQUFFLFlBQVk7Z0JBQ2hCLEVBQUUsRUFBRSxNQUFNO2dCQUNWLEVBQUUsRUFBRSxlQUFlO2dCQUNuQixFQUFFLEVBQUUsV0FBVzthQUNoQjtZQUNELGFBQWEsRUFBRTtnQkFDYixFQUFFLEVBQUUsbUJBQW1CO2dCQUN2QixFQUFFLEVBQUUsTUFBTTtnQkFDVixFQUFFLEVBQUUseUJBQXlCO2dCQUM3QixFQUFFLEVBQUUsc0JB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K0M7O0lBQy9DLHdDQUFvRDs7SUFFcEQsc0NBQXdDOztJQUN4QyxpQ0FBOEI7O0lBRTlCLHdDQUFvRDs7SUFDcEQsMENBQWdEOztJQUNoRCwyQ0FBa0Q7O0lBQ2xELG9DQUEyQzs7SUFDM0MsNkNBQXNEOzs7OztJQUt0RCw0Q0FBd0I7Ozs7O0lBS3hCLDZDQUF5Qjs7Ozs7SUFFekIsc0NBQXdCOztJQUN4QixpQ0FBa0I7O0lBQ2xCLGtDQUFtQjs7SUFFbkIsaUNBQXFCOztJQUNyQiwyQ0FBeUI7O0lBRXpCLG1EQUF1Qzs7SUEyTHZDLDhDQW1FRTs7Ozs7SUE1UFUsdUNBQXVDOzs7OztJQUNqRCw4QkFBNkI7Ozs7O0lBQzdCLGtDQUFzQjs7OztJQWtReEIsdUJBQXdCO0lBQ3hCLG9CQUFxQjtJQUNyQixrQkFBbUI7SUFDbkIsbUJBQW9CO0lBQ3BCLGdDQUFpQztJQUNqQyx1Q0FBdUM7SUFDdkMsZUFBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsIEVsZW1lbnRSZWYsIFZpZXdDaGlsZCwgU2ltcGxlQ2hhbmdlcywgTmdab25lLFxuICBDaGFuZ2VEZXRlY3RvclJlZiwgT3V0cHV0LCBJbnB1dCwgQWZ0ZXJWaWV3SW5pdCwgT25Jbml0LCBPbkNoYW5nZXMsIEV2ZW50RW1pdHRlclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbi8vIGltcG9ydCB7IEh0dHAsIFJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvaHR0cCc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBDYXB0Y2hhRGF0YVNlcnZpY2UsIFNlcnZlclBheWxvYWQgfSBmcm9tICcuL2NhcHRjaGEtZGF0YS5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnY29tbW9uLWNhcHRjaGEnLFxuICB0ZW1wbGF0ZVVybDogJy4vY2FwdGNoYS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2NhcHRjaGEuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBDYXB0Y2hhQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25Jbml0LCBPbkNoYW5nZXMge1xuXG4gIEBWaWV3Q2hpbGQoJ2ltYWdlJykgaW1hZ2VDb250YWluZXI6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ2F1ZGlvRWxlbWVudCcpIGF1ZGlvRWxlbWVudDogRWxlbWVudFJlZjtcbiAgLy8gdHNsaW50OmRpc2FibGU6bm8taW5wdXQtcmVuYW1lXG4gIEBJbnB1dCgnYXBpQmFzZVVybCcpIGFwaUJhc2VVcmw6IHN0cmluZztcbiAgQElucHV0KCdub25jZScpIG5vbmNlOiBzdHJpbmc7XG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1vdXRwdXQtb24tcHJlZml4XG4gIEBPdXRwdXQoKSBvblZhbGlkVG9rZW4gPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcbiAgQElucHV0KCdzdWNjZXNzTWVzc2FnZScpIHN1Y2Nlc3NNZXNzYWdlOiBzdHJpbmc7XG4gIEBJbnB1dCgnZWFnZXJGZXRjaEF1ZGlvJykgZWFnZXJGZXRjaEF1ZGlvOiBzdHJpbmc7XG4gIEBJbnB1dCgnbGFuZ3VhZ2UnKSBsYW5ndWFnZTogc3RyaW5nID0gJ2VuJztcbiAgQElucHV0KCd1c2VyUHJvbXB0TWVzc2FnZScpIHVzZXJQcm9tcHRNZXNzYWdlOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEh0dHAgZXJyb3IgcmVzcG9uc2UgZm9yIGZldGNoaW5nIGEgQ0FQVENIQSBpbWFnZS5cbiAgICovXG4gIGVycm9yRmV0Y2hpbmdJbWcgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBIdHRwIGVycm9yIHJlc3BvbnNlIGZvciB2ZXJpZnlpbmcgdXNlcidzIGFuc3dlci5cbiAgICovXG4gIGVycm9yVmVyaWZ5QW5zd2VyID0gbnVsbDtcblxuICBwcml2YXRlIHZhbGlkYXRpb24gPSAnJztcbiAgcHVibGljIGF1ZGlvID0gJyc7XG4gIHB1YmxpYyBhbnN3ZXIgPSAnJztcblxuICBzdGF0ZTogQ0FQVENIQV9TVEFURTtcbiAgaW5jb3JyZWN0QW5zd2VyOiBib29sZWFuO1xuXG4gIHB1YmxpYyBmZXRjaGluZ0F1ZGlvSW5Qcm9ncmVzcyA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZGF0YVNlcnZpY2U6IENhcHRjaGFEYXRhU2VydmljZSxcbiAgICBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lKSB7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmZvcmNlUmVmcmVzaC5iaW5kKHRoaXMpO1xuICAgIHdpbmRvd1snY2EuYmNnb3YuY2FwdGNoYVJlZnJlc2gnXSA9IHRoaXMucHVibGljRm9yY2VSZWZyZXNoLmJpbmQodGhpcyk7XG5cbiAgICAvLyBpZighdGhpcy51c2VyUHJvbXB0TWVzc2FnZSl7XG4gICAgLy8gICB0aGlzLnVzZXJQcm9tcHRNZXNzYWdlID0gXCJFbnRlciB0aGUgdGV4dCB5b3UgZWl0aGVyIHNlZSBpbiB0aGUgYm94IG9yIHlvdSBoZWFyIGluIHRoZSBhdWRpb1wiO1xuICAgIC8vIH1cbiAgfVxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5mb3JjZVJlZnJlc2goKTtcbiAgfVxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgLy8gd2hlbiBjaGFuZ2luZyBsYW5ndWFnZSwgaWYgYXVkaW8gaXMgZW1wdHkgdGhlbiBubyBuZWVkIHRvIHJlZmV0Y2hcbiAgICBpZiAoIWNoYW5nZXMubGFuZ3VhZ2UgfHwgIXRoaXMuYXVkaW8gfHwgdGhpcy5hdWRpby5sZW5ndGggPT09IDApIHtcbiAgICAgIGlmICghKGNoYW5nZXMucmVsb2FkQ2FwdGNoYSAmJiAodHJ1ZSA9PT0gY2hhbmdlcy5yZWxvYWRDYXB0Y2hhLnByZXZpb3VzVmFsdWVcbiAgICAgICAgfHwgZmFsc2UgPT09IGNoYW5nZXMucmVsb2FkQ2FwdGNoYS5wcmV2aW91c1ZhbHVlKVxuICAgICAgICAmJiAoY2hhbmdlcy5yZWxvYWRDYXB0Y2hhLmN1cnJlbnRWYWx1ZSAhPT0gY2hhbmdlcy5yZWxvYWRDYXB0Y2hhLnByZXZpb3VzVmFsdWUpKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuZ2V0TmV3Q2FwdGNoYShmYWxzZSk7XG4gIH1cblxuICBmb3JjZVJlZnJlc2goKSB7XG4gICAgdGhpcy5nZXROZXdDYXB0Y2hhKGZhbHNlKTtcbiAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuXG4gIHB1YmxpY0ZvcmNlUmVmcmVzaCgpIHtcbiAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4gdGhpcy5mb3JjZVJlZnJlc2goKSk7XG4gIH1cblxuICBhbnN3ZXJDaGFuZ2VkKGV2ZW50OiBhbnkpIHtcbiAgICBpZiAodGhpcy5hbnN3ZXIubGVuZ3RoIDwgNikge1xuICAgICAgdGhpcy5pbmNvcnJlY3RBbnN3ZXIgPSBudWxsO1xuICAgIH1cbiAgICBpZiAodGhpcy5hbnN3ZXIubGVuZ3RoID09PSA2KSB7XG4gICAgICB0aGlzLnN0YXRlID0gQ0FQVENIQV9TVEFURS5WRVJJRllJTkdfQU5TV0VSO1xuICAgICAgdGhpcy5pbmNvcnJlY3RBbnN3ZXIgPSBudWxsO1xuICAgICAgdGhpcy5kYXRhU2VydmljZS52ZXJpZnlDYXB0Y2hhKHRoaXMuYXBpQmFzZVVybCwgdGhpcy5ub25jZSwgdGhpcy5hbnN3ZXIsIHRoaXMudmFsaWRhdGlvbikuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgICAgY29uc3QgcGF5bG9hZCA9IHJlc3BvbnNlLmJvZHk7XG4gICAgICAgIGlmICh0aGlzLmlzVmFsaWRQYXlsb2FkKHBheWxvYWQpKSB7XG4gICAgICAgICAgdGhpcy5oYW5kbGVWZXJpZnkocGF5bG9hZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZSA9IENBUFRDSEFfU1RBVEUuRVJST1JfVkVSSUZZO1xuICAgICAgICAgIHRoaXMuZXJyb3JWZXJpZnlBbnN3ZXIgPSB0aGlzLmNyZWF0ZUVycm9yVGV4dExpbmUocmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICB0aGlzLnN0YXRlID0gQ0FQVENIQV9TVEFURS5FUlJPUl9WRVJJRlk7XG4gICAgICAgICAgdGhpcy5lcnJvclZlcmlmeUFuc3dlciA9IHRoaXMuY3JlYXRlRXJyb3JUZXh0TGluZShlcnJvcik7XG4gICAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yIHJlc3BvbnNlIGZyb20gdmVyaWZ5aW5nIHVzZXIgYW5zd2VyOiAlbycsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvLyBDYWxsIHRoZSBiYWNrZW5kIHRvIHNlZSBpZiBvdXIgYW5zd2VyIGlzIGNvcnJlY3RcbiAgcHJpdmF0ZSBoYW5kbGVWZXJpZnkocGF5bG9hZDogYW55KSB7XG4gICAgLy8gVGhlcmUgY291bGQgYmUgdGhlIHJhcmUgY2hhbmdlIHdoZXJlIGFuIGludmFsaWQgcGF5bG9hZCByZXNwb25zZSBpcyByZWNlaXZlZC5cbiAgICBpZiAocGF5bG9hZC52YWxpZCA9PT0gdHJ1ZSkge1xuICAgICAgdGhpcy5zdGF0ZSA9IENBUFRDSEFfU1RBVEUuU1VDQ0VTU19WRVJJRllfQU5TV0VSX0NPUlJFQ1Q7XG4gICAgICB0aGlzLm9uVmFsaWRUb2tlbi5lbWl0KHBheWxvYWQuand0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5pbmNvcnJlY3RBbnN3ZXIgPSB0cnVlO1xuICAgICAgdGhpcy5hbnN3ZXIgPSAnJztcbiAgICAgIHRoaXMuYXVkaW8gPSAnJztcbiAgICAgIC8vIFRoZXkgZmFpbGVkIC0gdHJ5IGEgbmV3IG9uZS5cbiAgICAgIHRoaXMuZ2V0TmV3Q2FwdGNoYSh0cnVlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2FzZSB3aGVyZSBIVFRQIDIwMCByZXNwb25zZSBjb2RlIGlzIHJlY2VpdmVkIGJ5IHRoZSBwYXlsb2FkIGlzIGluY29ycmVjdCBvciBjb3JydXB0LlxuICAgKiBUaGUgb2NjdXJhbmNlIG9mIHRoaXMgdHlwZSBvZiBjYXNlIHNob3VsZCBiZSByYXJlLlxuICAgKiBAcGFyYW0gcGF5bG9hZFxuICAgKi9cbiAgcHJpdmF0ZSBpc1ZhbGlkUGF5bG9hZChwYXlsb2FkKSB7XG4gICAgLy8gY29uc29sZS5kZWJ1ZygnUmVzcG9uc2UgcGF5bG9hZDogJW8nLCBwYXlsb2FkKTtcbiAgICBpZiAoIXBheWxvYWQpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ3BheWxvYWQgY2Fubm90IGJlIG51bGwgb3IgdW5kZWZpbmVkIG9yIDAnKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgaGFzVmFsdWVQcm9wID0gcGF5bG9hZC5oYXNPd25Qcm9wZXJ0eSgndmFsaWQnKTtcbiAgICAgIGlmICghaGFzVmFsdWVQcm9wKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ3BheWxvYWQgbXVzdCBoYXZlIGl0cyBvd24gcHJvcGVydHkgbmFtZWQgXFwndmFsaWRcXCcnKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHJldHJ5RmV0Y2hDYXB0Y2hhKCkge1xuICAgIGNvbnNvbGUubG9nKCdSZXRyeSBjYXB0Y2hhJyk7XG4gICAgdGhpcy5zdGF0ZSA9IHVuZGVmaW5lZDtcblxuICAgIC8qKlxuICAgICAqIHdhaXQgZm9yIDAuNSBzZW9uZCBiZWZvcmUgcmVzdWJtaXR0aW5nXG4gICAgICovXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLmdldE5ld0NhcHRjaGEoZmFsc2UpO1xuICAgIH0sIDEwMCk7XG4gIH1cblxuICBwdWJsaWMgcGxheUF1ZGlvKCkge1xuICAgIGlmICh0aGlzLmF1ZGlvICYmIHRoaXMuYXVkaW8ubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5hdWRpb0VsZW1lbnQubmF0aXZlRWxlbWVudC5wbGF5KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZmV0Y2hBdWRpbyh0cnVlKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGZldGNoQXVkaW8ocGxheUltbWVkaWF0ZWx5OiBib29sZWFuID0gZmFsc2UpIHtcbiAgICBpZiAoIXRoaXMuZmV0Y2hpbmdBdWRpb0luUHJvZ3Jlc3MpIHtcbiAgICAgIHRoaXMuZmV0Y2hpbmdBdWRpb0luUHJvZ3Jlc3MgPSB0cnVlO1xuICAgICAgdGhpcy5kYXRhU2VydmljZS5mZXRjaEF1ZGlvKHRoaXMuYXBpQmFzZVVybCwgdGhpcy52YWxpZGF0aW9uLCB0aGlzLmxhbmd1YWdlKS5zdWJzY3JpYmUoKHJlc3BvbnNlOiBIdHRwUmVzcG9uc2U8YW55PikgPT4ge1xuICAgICAgICB0aGlzLmZldGNoaW5nQXVkaW9JblByb2dyZXNzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuYXVkaW8gPSByZXNwb25zZS5ib2R5LmF1ZGlvO1xuICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgaWYgKHBsYXlJbW1lZGlhdGVseSkge1xuICAgICAgICAgIHRoaXMuYXVkaW9FbGVtZW50Lm5hdGl2ZUVsZW1lbnQucGxheSgpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICB0aGlzLmZldGNoaW5nQXVkaW9JblByb2dyZXNzID0gZmFsc2U7XG4gICAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yIHJlc3BvbnNlIGZyb20gZmV0Y2hpbmcgYXVkaW8gQ0FQVENIQTogJW8nLCBlcnJvcik7XG4gICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdldE5ld0NhcHRjaGEoZXJyb3JDYXNlOiBhbnkpIHtcbiAgICB0aGlzLnN0YXRlID0gQ0FQVENIQV9TVEFURS5GRVRDSElOR19DQVBUQ0hBX0lNRztcbiAgICB0aGlzLmF1ZGlvID0gJyc7XG5cbiAgICAvLyBSZXNldCB0aGluZ3NcbiAgICBpZiAoIWVycm9yQ2FzZSkge1xuICAgICAgLy8gTGV0IHRoZW0ga25vdyB0aGV5IGZhaWxlZCBpbnN0ZWFkIG9mIHdpcGluZyBvdXQgdGhlIGFuc3dlciBhcmVhXG4gICAgICAvLyBDb250cnVjdGluZyB0aGlzIGZvcm0gb24gcGFnZSBsb2FkL3JlbG9hZCB3aWxsIGhhdmUgZXJyb3JDYXNlID0gZmFsc2VcbiAgICAgIHRoaXMuaW5jb3JyZWN0QW5zd2VyID0gbnVsbDtcbiAgICB9XG5cblxuICAgIHRoaXMuZGF0YVNlcnZpY2UuZmV0Y2hEYXRhKHRoaXMuYXBpQmFzZVVybCwgdGhpcy5ub25jZSkuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgIHRoaXMuc3RhdGUgPSBDQVBUQ0hBX1NUQVRFLlNVQ0NFU1NfRkVUQ0hfSU1HO1xuXG4gICAgICBjb25zdCBwYXlsb2FkID0gcmVzcG9uc2UuYm9keTtcbiAgICAgIHRoaXMuaW1hZ2VDb250YWluZXIubmF0aXZlRWxlbWVudC5pbm5lckhUTUwgPSBwYXlsb2FkLmNhcHRjaGE7XG4gICAgICB0aGlzLnZhbGlkYXRpb24gPSBwYXlsb2FkLnZhbGlkYXRpb247XG4gICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcblxuICAgICAgaWYgKHRoaXMuZWFnZXJGZXRjaEF1ZGlvID09PSAndHJ1ZScpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ0ZldGNoIGF1ZGlvIGVhZ2VybHknKTtcbiAgICAgICAgdGhpcy5mZXRjaEF1ZGlvKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBjb25zb2xlLmxvZygnTm90IHRvIGZldGNoIGF1ZGlvIGVhZ2VybHknKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IENBUFRDSEFfU1RBVEUuRVJST1JfRkVUQ0hfSU1HO1xuICAgICAgICB0aGlzLmVycm9yRmV0Y2hpbmdJbWcgPSB0aGlzLmNyZWF0ZUVycm9yVGV4dExpbmUoZXJyb3IpO1xuICAgICAgICBjb25zb2xlLmxvZygnRXJyb3IgZXNwb25zZSBmcm9tIGZldGNoaW5nIENBUFRDSEEgdGV4dDogJW8nLCBlcnJvcik7XG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUVycm9yVGV4dExpbmUoZXJyb3IpIHtcblxuICAgIGxldCBsaW5lID0gJ0Vycm9yIHN0YXR1czogJyArIGVycm9yLnN0YXR1cztcbiAgICBpZiAoZXJyb3Iuc3RhdHVzVGV4dCkge1xuICAgICAgbGluZSA9IGxpbmUgKyAnLCBzdGF0dXMgdGV4dDogJyArIGVycm9yLnN0YXR1c1RleHQ7XG4gICAgfVxuICAgIHJldHVybiBsaW5lO1xuICB9XG5cbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1lbWJlci1vcmRlcmluZ1xuICBwdWJsaWMgdHJhbnNsYXRlZE1lc3NhZ2VzID0ge1xuICAgIHBsYXlBdWRpbzoge1xuICAgICAgZW46ICdQbGF5IEF1ZGlvJyxcbiAgICAgIHpoOiAn5pKt5pS+5aOw6Z+zJyxcbiAgICAgIGZyOiAnTGVjdHVyZSBhdWRpbycsXG4gICAgICBwYTogJ+CohuCooeCpgOCokyDgqJrgqLLgqL7gqJMnLFxuICAgIH0sXG4gICAgdHJ5QW5vdGhlckltZzoge1xuICAgICAgZW46ICdUcnkgYW5vdGhlciBpbWFnZScsXG4gICAgICB6aDogJ+aNouS4quWbvuWDjycsXG4gICAgICBmcjogJ0Vzc2F5ZXogdW5lIGF1dHJlIGltYWdlJyxcbiAgICAgIHBhOiAn4KiV4KmL4KiIIOCoueCpi+CosCDgqJrgqL/gqbHgqKTgqLAg4KiF4Kic4Ki84Kiu4Ki+4KiTJyxcbiAgICB9LFxuICAgIHVzZXJQcm9tcHRNZXNzYWdlOiB7XG4gICAgICBlbjogJ0VudGVyIHRoZSB0ZXh0IHlvdSBlaXRoZXIgc2VlIGluIHRoZSBib3ggb3IgeW91IGhlYXIgaW4gdGhlIGF1ZGlvJyxcbiAgICAgIHpoOiAn6K+36L6T5YWl55yL5Yiw5oiW5ZCs5Yiw55qE5paH5a2XJyxcbiAgICAgIGZyOiAnRW50cmV6IGxlIHRleHRlIHF1ZSB2b3VzIHZveWV6IGRhbnMgbGEgY2FzZSBvdSBxdWUgdm91cyBlbnRlbmRleiBkYW5zIGxlIHNvbicsXG4gICAgICBwYTogJ+CoieCouSDgqJ/gqYjgqJXgqLjgqJ8g4Kim4Ki+4KiW4KiyIOColeCosOCpiyDgqJzgqYsg4Kik4KmB4Ki44KmA4KiCIOCorOColeCouOCphyDgqLXgqL/gqbHgqJog4Kim4KmH4KiW4Kim4KmHIOCoueCpiyDgqJzgqL7gqIIg4Kik4KmB4Ki44KmA4KiCIOCohuCooeCpgOCokyDgqLXgqL/gqbHgqJog4Ki44KmB4Kij4Kim4KmHIOCoueCpiycsXG4gICAgfSxcbiAgICBpbmNvcnJlY3RBbnN3ZXI6IHtcbiAgICAgIGVuOiAnSW5jb3JyZWN0IGFuc3dlciwgcGxlYXNlIHRyeSBhZ2Fpbi4nLFxuICAgICAgemg6ICfnrZTmoYjkuI3lr7njgILor7fph43or5XjgIInLFxuICAgICAgZnI6ICdNYXV2YWlzZSByw6lwb25zZSwgdmV1aWxsZXogcsOpZXNzYXllci4nLFxuICAgICAgcGE6ICfgqJfgqLLgqKQg4Kic4Ki14Ki+4KisLCDgqJXgqL/gqLDgqKrgqL4g4KiV4Kiw4KiV4KmHIOCopuCpgeCorOCovuCosOCoviDgqJXgqYvgqLjgqLzgqL/gqLjgqLwg4KiV4Kiw4KmLLicsXG4gICAgfSxcbiAgICBzdWNjZXNzTWVzc2FnZToge1xuICAgICAgZW46ICdZb3UgY2FuIHN1Ym1pdCB5b3VyIGFwcGxpY2F0aW9uIG5vdy4nLFxuICAgICAgemg6ICfkvaDnjrDlnKjlj6/ku6Xmj5DkuqTnlLPor7fkuobjgIInLFxuICAgICAgZnI6ICdWb3VzIHBvdXZleiBzb3VtZXR0cmUgdm90cmUgY2FuZGlkYXR1cmUgbWFpbnRlbmFudC4nLFxuICAgICAgcGE6ICfgqKTgqYHgqLjgqYDgqIIg4KiG4Kiq4Kij4KmAIOCoheCosOConOCovOCpgCDgqLngqYHgqKPgqYcg4Kiq4KmH4Ki44Ki8IOColeCosCDgqLjgqJXgqKbgqYcg4Ki54KmLJyxcbiAgICB9LFxuICAgIGNvcnJlY3Q6IHtcbiAgICAgIGVuOiAnQ29ycmVjdC4nLFxuICAgICAgemg6ICfmraPnoa7jgIInLFxuICAgICAgZnI6ICdDb3JyZWN0LicsXG4gICAgICBwYTogJ+CouOCoueCpgCDgqJXgqLDgqYsnLFxuICAgIH0sXG4gICAgbG9hZGluZ0ltYWdlOiB7XG4gICAgICBlbjogJ0xvYWRpbmcgQ0FQVENIQSBpbWFnZScsXG4gICAgICB6aDogJ+ato+WcqOS4i+i9vemqjOivgeeggScsXG4gICAgICBmcjogJ0NoYXJnZW1lbnQgZGUgbFxcJ2ltYWdlIENBUFRDSEEnLFxuICAgICAgcGE6ICfgqJXgqYjgqKrgqJ/gqJrgqL4g4Kia4Ki/4Kmx4Kik4KiwIOCosuCpi+CooSDgqJXgqLAg4Kiw4Ki/4Ki54Ki+IOCoueCpiCcsXG4gICAgfSxcbiAgICBicm93c2VyTm90U3VwcG9ydEF1ZGlvOiB7XG4gICAgICBlbjogJ1lvdXIgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IHRoZSBhdWRpbyBlbGVtZW50LicsXG4gICAgICB6aDogJ+S9oOeahOa1j+iniOWZqOS4jeaUr+aMgeaSremfsycsXG4gICAgICBmcjogJ1ZvdHJlIG5hdmlnYXRldXIgbmUgc3VwcG9ydGUgcGFzIGxcXCfDqWzDqW1lbnQgYXVkaW8uJyxcbiAgICAgIHBhOiAn4Kik4KmB4Ki54Ki+4Kih4Ki+IOCorOCpjeCosOCovuCoieConOCovOCosCDgqIbgqKHgqYDgqJMg4KiQ4Kiy4KmA4Kiu4KmI4KiC4KifIOCopuCoviDgqLjgqK7gqLDgqKXgqKgg4Kio4Ki54KmA4KiCIOColeCosOCopuCovi4nLFxuICAgIH0sXG4gICAgdmVyaWZ5aW5nQW5zd2VyOiB7XG4gICAgICBlbjogJ1ZlcmlmeWluZyB5b3VyIGFuc3dlci4uLicsXG4gICAgICB6aDogJ+ato+WcqOmqjOivgeetlOahiC4uLicsXG4gICAgICBmcjogJ1bDqXJpZmljYXRpb24gZGUgdm90cmUgcsOpcG9uc2UgLi4uJyxcbiAgICAgIHBhOiAn4Kik4KmB4Ki54Ki+4Kih4Ki+IOConOCoteCovuCorCDgqKTgqLjgqKbgqYDgqJUg4KiV4KiwIOCosOCov+CoueCoviDgqLngqYggLi4uJyxcbiAgICB9LFxuICAgIGVycm9yUmV0cmlldmluZ0ltZzoge1xuICAgICAgZW46ICdFcnJvciBoYXBwZW5lZCB3aGlsZSByZXRyaWV2aW5nIENBUFRDSEEgaW1hZ2UuIHBsZWFzZSB7e2NsaWNrIGhlcmV9fSB0byB0cnkgYWdhaW4nLFxuICAgICAgemg6ICfpqozor4HnoIHkuIvovb3plJnor6/jgILor7d7e+eCueWHu+i/memHjH196YeN6K+VJyxcbiAgICAgIGZyOiAnVW5lIGVycmV1ciBzXFwnZXN0IHByb2R1aXRlIGxvcnMgZGUgbGEgcsOpY3Vww6lyYXRpb24gZGUgbFxcJ2ltYWdlIENBUFRDSEEuIHNcXCdpbCB2b3VzIHBsYcOudCB7e2NsaXF1ZXogaWNpfX0gcG91ciByw6llc3NheWVyJyxcbiAgICAgIHBhOiAn4KiV4KmI4Kiq4Kif4Kia4Ki+IOComuCov+CpseCopOCosCDgqKjgqYLgqbAg4Kiq4KmN4Kiw4Ki+4Kiq4KikIOColeCosOCopuCphyDgqLjgqK7gqYfgqIIg4Kik4Kiw4KmB4Kmx4Kif4KmAIOCoieCopOCoquCpsOCoqCDgqLngqYvgqIguIOColeCov+CosOCoquCoviDgqJXgqLDgqJXgqYcg4Kim4KmB4Kis4Ki+4Kiw4Ki+IOColeCpi+CouOCovOCov+CouOCovCDgqJXgqLDgqKgg4Kiy4KiIIHt74KiH4Kmx4Kil4KmHIOColeCosuCov+ColSDgqJXgqLDgqYt9fScsXG4gICAgfSxcbiAgICBlcnJvclZlcmlmeWluZ0Fuc3dlcjoge1xuICAgICAgZW46ICdFcnJvciBoYXBwZW5lZCB3aGlsZSB2ZXJpZnlpbmcgeW91ciBhbnN3ZXIuIHBsZWFzZSB7e2NsaWNrIGhlcmV9fSB0byB0cnkgYWdhaW4nLFxuICAgICAgemg6ICfpqozor4HnrZTmoYjov4fnqIvlj5HnlJ/plJnor6/jgILor7d7e+eCueWHu+i/memHjH196YeN6K+VJyxcbiAgICAgIGZyOiAnVW5lIGVycmV1ciBzXFwnZXN0IHByb2R1aXRlIGxvcnMgZGUgbGEgdsOpcmlmaWNhdGlvbiBkZSB2b3RyZSByw6lwb25zZS4gc1xcJ2lsIHZvdXMgcGxhw650IHt7Y2xpcXVleiBpY2l9fSBwb3VyIHLDqWVzc2F5ZXInLFxuICAgICAgcGE6ICfgqKTgqYHgqLngqL7gqKHgqL4g4Kic4Ki14Ki+4KisIOCopOCouOCopuCpgOColSDgqJXgqLDgqKgg4Ki14KmH4Kiy4KmHIOCol+CosuCopOCpgCDgqIbgqIgg4KiV4Ki/4Kiw4Kiq4Ki+IOColeCosOColeCphyDgqKbgqYHgqKzgqL7gqLDgqL4g4KiV4KmL4Ki44Ki84Ki/4Ki44Ki8IOColeCosOCoqCDgqLLgqIgge3vgqIfgqbHgqKXgqYcg4KiV4Kiy4Ki/4KiVIOColeCosOCpi319JyxcbiAgICB9LFxuICB9O1xufVxuXG4vKipcbiAqIDcgbXV0dWFsbHkgZXhjbHVzaXZlIHN0YXRlcywgdGhlIHByb2dyYW0gY2FuIG9ubHkgYmUgaW4gb25lIG9mIHRoZXNlIHN0YXRlXG4gKiBhdCBhbnkgZ2l2ZW4gcG9pbnQuLlxuICovXG5lbnVtIENBUFRDSEFfU1RBVEUge1xuICBGRVRDSElOR19DQVBUQ0hBX0lNRyA9IDEsXG4gIFNVQ0NFU1NfRkVUQ0hfSU1HID0gMixcbiAgRVJST1JfRkVUQ0hfSU1HID0gMyxcbiAgVkVSSUZZSU5HX0FOU1dFUiA9IDQsXG4gIFNVQ0NFU1NfVkVSSUZZX0FOU1dFUl9DT1JSRUNUID0gNSxcbiAgLy8gaHR0cCBlcnJvciBkdXJpbmcgdmVyaWZpY2F0aW9uIGNhbGwuXG4gIEVSUk9SX1ZFUklGWSA9IDYsXG4gIC8vIFNVQ0NFU1NfVkVSSUZZX0FOU1dFUl9JTkNPUlJFQ1QgPSA2LFxufVxuIl19