/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, ViewChild, NgZone, ChangeDetectorRef, Output, Input, EventEmitter } from '@angular/core';
import { CaptchaDataService } from './captcha-data.service';
export class CaptchaComponent {
    /**
     * @param {?} dataService
     * @param {?} cd
     * @param {?} ngZone
     */
    constructor(dataService, cd, ngZone) {
        this.dataService = dataService;
        this.cd = cd;
        this.ngZone = ngZone;
        // tslint:disable-next-line:no-output-on-prefix
        this.onValidToken = new EventEmitter();
        this.language = 'en';
        /**
         * Http error response for fetching a CAPTCHA image.
         */
        this.errorFetchingImg = null;
        /**
         * Http error response for verifying user's answer.
         */
        this.errorVerifyAnswer = null;
        this.validation = '';
        this.audio = '';
        this.answer = '';
        this.fetchingAudioInProgress = false;
        // tslint:disable-next-line:member-ordering
        this.translatedMessages = {
            playAudio: {
                en: 'Play Audio',
                zh: '播放声音',
                fr: 'Lecture audio',
                pa: 'ਆਡੀਓ ਚਲਾਓ',
            },
            tryAnotherImg: {
                en: 'Try another image',
                zh: '换个图像',
                fr: 'Essayez une autre image',
                pa: 'ਕੋਈ ਹੋਰ ਚਿੱਤਰ ਅਜ਼ਮਾਓ',
            },
            userPromptMessage: {
                en: 'Enter the text you either see in the box or you hear in the audio',
                zh: '请输入看到或听到的文字',
                fr: 'Entrez le texte que vous voyez dans la case ou que vous entendez dans le son',
                pa: 'ਉਹ ਟੈਕਸਟ ਦਾਖਲ ਕਰੋ ਜੋ ਤੁਸੀਂ ਬਕਸੇ ਵਿੱਚ ਦੇਖਦੇ ਹੋ ਜਾਂ ਤੁਸੀਂ ਆਡੀਓ ਵਿੱਚ ਸੁਣਦੇ ਹੋ',
            },
            incorrectAnswer: {
                en: 'Incorrect answer, please try again.',
                zh: '答案不对。请重试。',
                fr: 'Mauvaise réponse, veuillez réessayer.',
                pa: 'ਗਲਤ ਜਵਾਬ, ਕਿਰਪਾ ਕਰਕੇ ਦੁਬਾਰਾ ਕੋਸ਼ਿਸ਼ ਕਰੋ.',
            },
            successMessage: {
                en: 'You can submit your application now.',
                zh: '你现在可以提交申请了。',
                fr: 'Vous pouvez soumettre votre candidature maintenant.',
                pa: 'ਤੁਸੀਂ ਆਪਣੀ ਅਰਜ਼ੀ ਹੁਣੇ ਪੇਸ਼ ਕਰ ਸਕਦੇ ਹੋ',
            },
            correct: {
                en: 'Correct.',
                zh: '正确。',
                fr: 'Correct.',
                pa: 'ਸਹੀ ਕਰੋ',
            },
            loadingImage: {
                en: 'Loading CAPTCHA image',
                zh: '正在下载验证码',
                fr: 'Chargement de l\'image CAPTCHA',
                pa: 'ਕੈਪਟਚਾ ਚਿੱਤਰ ਲੋਡ ਕਰ ਰਿਹਾ ਹੈ',
            },
            browserNotSupportAudio: {
                en: 'Your browser does not support the audio element.',
                zh: '你的浏览器不支持播音',
                fr: 'Votre navigateur ne supporte pas l\'élément audio.',
                pa: 'ਤੁਹਾਡਾ ਬ੍ਰਾਉਜ਼ਰ ਆਡੀਓ ਐਲੀਮੈਂਟ ਦਾ ਸਮਰਥਨ ਨਹੀਂ ਕਰਦਾ.',
            },
            verifyingAnswer: {
                en: 'Verifying your answer...',
                zh: '正在验证答案...',
                fr: 'Vérification de votre réponse ...',
                pa: 'ਤੁਹਾਡਾ ਜਵਾਬ ਤਸਦੀਕ ਕਰ ਰਿਹਾ ਹੈ ...',
            },
            errorRetrievingImg: {
                en: 'Error happened while retrieving CAPTCHA image. please {{click here}} to try again',
                zh: '验证码下载错误。请{{点击这里}}重试',
                fr: 'Une erreur s\'est produite lors de la récupération de l\'image CAPTCHA. s\'il vous plaît {{cliquez ici}} pour réessayer',
                pa: 'ਕੈਪਟਚਾ ਚਿੱਤਰ ਨੂੰ ਪ੍ਰਾਪਤ ਕਰਦੇ ਸਮੇਂ ਤਰੁੱਟੀ ਉਤਪੰਨ ਹੋਈ. ਕਿਰਪਾ ਕਰਕੇ ਦੁਬਾਰਾ ਕੋਸ਼ਿਸ਼ ਕਰਨ ਲਈ {{ਇੱਥੇ ਕਲਿਕ ਕਰੋ}}',
            },
            errorVerifyingAnswer: {
                en: 'Error happened while verifying your answer. please {{click here}} to try again',
                zh: '验证答案过程发生错误。请{{点击这里}}重试',
                fr: 'Une erreur s\'est produite lors de la vérification de votre réponse. s\'il vous plaît {{cliquez ici}} pour réessayer',
                pa: 'ਤੁਹਾਡਾ ਜਵਾਬ ਤਸਦੀਕ ਕਰਨ ਵੇਲੇ ਗਲਤੀ ਆਈ ਕਿਰਪਾ ਕਰਕੇ ਦੁਬਾਰਾ ਕੋਸ਼ਿਸ਼ ਕਰਨ ਲਈ {{ਇੱਥੇ ਕਲਿਕ ਕਰੋ}}',
            },
        };
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.forceRefresh.bind(this);
        window['ca.bcgov.captchaRefresh'] = this.publicForceRefresh.bind(this);
        // if(!this.userPromptMessage){
        //   this.userPromptMessage = "Enter the text you either see in the box or you hear in the audio";
        // }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.forceRefresh();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        // when changing language, if audio is empty then no need to refetch
        if (!changes.language || !this.audio || this.audio.length === 0) {
            if (!(changes.reloadCaptcha && (true === changes.reloadCaptcha.previousValue
                || false === changes.reloadCaptcha.previousValue)
                && (changes.reloadCaptcha.currentValue !== changes.reloadCaptcha.previousValue))) {
                return;
            }
        }
        this.getNewCaptcha(false);
    }
    /**
     * @return {?}
     */
    forceRefresh() {
        this.getNewCaptcha(false);
        this.cd.detectChanges();
    }
    /**
     * @return {?}
     */
    publicForceRefresh() {
        this.ngZone.run((/**
         * @return {?}
         */
        () => this.forceRefresh()));
    }
    /**
     * @param {?} event
     * @return {?}
     */
    answerChanged(event) {
        if (this.answer.length < 6) {
            this.incorrectAnswer = null;
        }
        if (this.answer.length === 6) {
            this.state = CAPTCHA_STATE.VERIFYING_ANSWER;
            this.incorrectAnswer = null;
            this.dataService.verifyCaptcha(this.apiBaseUrl, this.nonce, this.answer, this.validation).subscribe((/**
             * @param {?} response
             * @return {?}
             */
            response => {
                /** @type {?} */
                const payload = response.body;
                if (this.isValidPayload(payload)) {
                    this.handleVerify(payload);
                }
                else {
                    this.state = CAPTCHA_STATE.ERROR_VERIFY;
                    this.errorVerifyAnswer = this.createErrorTextLine(response);
                }
            }), (/**
             * @param {?} error
             * @return {?}
             */
            (error) => {
                this.state = CAPTCHA_STATE.ERROR_VERIFY;
                this.errorVerifyAnswer = this.createErrorTextLine(error);
                console.log('Error response from verifying user answer: %o', error);
            }));
        }
    }
    // Call the backend to see if our answer is correct
    /**
     * @private
     * @param {?} payload
     * @return {?}
     */
    handleVerify(payload) {
        // There could be the rare change where an invalid payload response is received.
        if (payload.valid === true) {
            this.state = CAPTCHA_STATE.SUCCESS_VERIFY_ANSWER_CORRECT;
            this.onValidToken.emit(payload.jwt);
        }
        else {
            this.incorrectAnswer = true;
            this.answer = '';
            this.audio = '';
            // They failed - try a new one.
            this.getNewCaptcha(true);
        }
    }
    /**
     * Case where HTTP 200 response code is received by the payload is incorrect or corrupt.
     * The occurance of this type of case should be rare.
     * @private
     * @param {?} payload
     * @return {?}
     */
    isValidPayload(payload) {
        // console.debug('Response payload: %o', payload);
        if (!payload) {
            console.error('payload cannot be null or undefined or 0');
            return false;
        }
        else {
            /** @type {?} */
            const hasValueProp = payload.hasOwnProperty('valid');
            if (!hasValueProp) {
                console.error('payload must have its own property named \'valid\'');
                return false;
            }
            else {
                return true;
            }
        }
    }
    /**
     * @return {?}
     */
    retryFetchCaptcha() {
        console.log('Retry captcha');
        this.state = undefined;
        /**
         * wait for 0.5 seond before resubmitting
         */
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.getNewCaptcha(false);
        }), 100);
    }
    /**
     * @return {?}
     */
    playAudio() {
        if (this.audio && this.audio.length > 0) {
            this.audioElement.nativeElement.play();
        }
        else {
            this.fetchAudio(true);
        }
    }
    /**
     * @private
     * @param {?=} playImmediately
     * @return {?}
     */
    fetchAudio(playImmediately = false) {
        if (!this.fetchingAudioInProgress) {
            this.fetchingAudioInProgress = true;
            this.dataService.fetchAudio(this.apiBaseUrl, this.validation, this.language).subscribe((/**
             * @param {?} response
             * @return {?}
             */
            (response) => {
                this.fetchingAudioInProgress = false;
                this.audio = response.body.audio;
                this.cd.detectChanges();
                if (playImmediately) {
                    this.audioElement.nativeElement.play();
                }
            }), (/**
             * @param {?} error
             * @return {?}
             */
            (error) => {
                this.fetchingAudioInProgress = false;
                console.log('Error response from fetching audio CAPTCHA: %o', error);
                this.cd.detectChanges();
            }));
        }
    }
    /**
     * @param {?} errorCase
     * @return {?}
     */
    getNewCaptcha(errorCase) {
        this.state = CAPTCHA_STATE.FETCHING_CAPTCHA_IMG;
        this.audio = '';
        // Reset things
        if (!errorCase) {
            // Let them know they failed instead of wiping out the answer area
            // Contructing this form on page load/reload will have errorCase = false
            this.incorrectAnswer = null;
        }
        this.dataService.fetchData(this.apiBaseUrl, this.nonce).subscribe((/**
         * @param {?} response
         * @return {?}
         */
        response => {
            this.state = CAPTCHA_STATE.SUCCESS_FETCH_IMG;
            /** @type {?} */
            const payload = response.body;
            this.imageContainer.nativeElement.innerHTML = payload.captcha;
            this.validation = payload.validation;
            this.cd.detectChanges();
            if (this.eagerFetchAudio === 'true') {
                // console.log('Fetch audio eagerly');
                this.fetchAudio();
            }
            else {
                // console.log('Not to fetch audio eagerly');
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        (error) => {
            this.state = CAPTCHA_STATE.ERROR_FETCH_IMG;
            this.errorFetchingImg = this.createErrorTextLine(error);
            console.log('Error esponse from fetching CAPTCHA text: %o', error);
            this.cd.detectChanges();
        }));
    }
    /**
     * @private
     * @param {?} error
     * @return {?}
     */
    createErrorTextLine(error) {
        /** @type {?} */
        let line = 'Error status: ' + error.status;
        if (error.statusText) {
            line = line + ', status text: ' + error.statusText;
        }
        return line;
    }
}
CaptchaComponent.decorators = [
    { type: Component, args: [{
                selector: 'common-captcha',
                template: "<div class=\"bcgov-captcha\">\n\n\n  <svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n    <defs>\n        <symbol id=\"icon-play-def\" viewBox=\"0 0 32 32\">\n            <path d=\"M16 0c-8.837 0-16 7.163-16 16s7.163 16 16 16 16-7.163 16-16-7.163-16-16-16zM16 29c-7.18 0-13-5.82-13-13s5.82-13 13-13 13 5.82 13 13-5.82 13-13 13zM12 9l12 7-12 7z\"></path>\n        </symbol>  \n\n        <symbol id=\"icon-loop-def\" viewBox=\"0 0 32 32\">\n          <path d=\"M27.802 5.197c-2.925-3.194-7.13-5.197-11.803-5.197-8.837 0-16 7.163-16 16h3c0-7.18 5.82-13 13-13 3.844 0 7.298 1.669 9.678 4.322l-4.678 4.678h11v-11l-4.198 4.197z\"></path>\n          <path d=\"M29 16c0 7.18-5.82 13-13 13-3.844 0-7.298-1.669-9.678-4.322l4.678-4.678h-11v11l4.197-4.197c2.925 3.194 7.13 5.197 11.803 5.197 8.837 0 16-7.163 16-16h-3z\"></path>\n        </symbol>  \n        \n        <symbol id=\"icon-check-def\" viewBox=\"0 0 24 24\">\n          <path d=\"M9 16.172l10.594-10.594 1.406 1.406-12 12-5.578-5.578 1.406-1.406z\"></path>\n        </symbol>    \n        \n        <symbol id=\"icon-exclamation-triangle-def\" viewBox=\"0 0 28 28\">\n            <path d=\"M16 21.484v-2.969c0-0.281-0.219-0.516-0.5-0.516h-3c-0.281 0-0.5 0.234-0.5 0.516v2.969c0 0.281 0.219 0.516 0.5 0.516h3c0.281 0 0.5-0.234 0.5-0.516zM15.969 15.641l0.281-7.172c0-0.094-0.047-0.219-0.156-0.297-0.094-0.078-0.234-0.172-0.375-0.172h-3.437c-0.141 0-0.281 0.094-0.375 0.172-0.109 0.078-0.156 0.234-0.156 0.328l0.266 7.141c0 0.203 0.234 0.359 0.531 0.359h2.891c0.281 0 0.516-0.156 0.531-0.359zM15.75 1.047l12 22c0.344 0.609 0.328 1.359-0.031 1.969s-1.016 0.984-1.719 0.984h-24c-0.703 0-1.359-0.375-1.719-0.984s-0.375-1.359-0.031-1.969l12-22c0.344-0.641 1.016-1.047 1.75-1.047s1.406 0.406 1.75 1.047z\"></path>\n        </symbol>\n        \n    </defs>\n  </svg>\n\n\n\n  <form style=\"clear:both\" #formRef=\"ngForm\">\n    <div [ngClass]=\"{'has-error': !!incorrectAnswer}\">\n      <div>\n        \n        <div class=\"spinner-box\" *ngIf=\"!state || state === 1\">\n         <div style=\"float:left; margin: 2px 0 1px 8px\">\n            <svg class=\"lds-spinner\" width=\"45px\"  height=\"45px\"  xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"xMidYMid\" style=\"background: none;\"><g transform=\"rotate(0 50 50)\">\n                <rect x=\"47\" y=\"22\" rx=\"9.4\" ry=\"4.4\" width=\"6\" height=\"16\" fill=\"#1d3f72\">\n                  <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.8888888888888888s\" repeatCount=\"indefinite\"></animate>\n                </rect>\n              </g><g transform=\"rotate(40 50 50)\">\n                <rect x=\"47\" y=\"22\" rx=\"9.4\" ry=\"4.4\" width=\"6\" height=\"16\" fill=\"#1d3f72\">\n                  <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.7777777777777778s\" repeatCount=\"indefinite\"></animate>\n                </rect>\n              </g><g transform=\"rotate(80 50 50)\">\n                <rect x=\"47\" y=\"22\" rx=\"9.4\" ry=\"4.4\" width=\"6\" height=\"16\" fill=\"#1d3f72\">\n                  <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.6666666666666666s\" repeatCount=\"indefinite\"></animate>\n                </rect>\n              </g><g transform=\"rotate(120 50 50)\">\n                <rect x=\"47\" y=\"22\" rx=\"9.4\" ry=\"4.4\" width=\"6\" height=\"16\" fill=\"#1d3f72\">\n                  <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.5555555555555556s\" repeatCount=\"indefinite\"></animate>\n                </rect>\n              </g><g transform=\"rotate(160 50 50)\">\n                <rect x=\"47\" y=\"22\" rx=\"9.4\" ry=\"4.4\" width=\"6\" height=\"16\" fill=\"#1d3f72\">\n                  <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.4444444444444444s\" repeatCount=\"indefinite\"></animate>\n                </rect>\n              </g><g transform=\"rotate(200 50 50)\">\n                <rect x=\"47\" y=\"22\" rx=\"9.4\" ry=\"4.4\" width=\"6\" height=\"16\" fill=\"#1d3f72\">\n                  <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.3333333333333333s\" repeatCount=\"indefinite\"></animate>\n                </rect>\n              </g><g transform=\"rotate(240 50 50)\">\n                <rect x=\"47\" y=\"22\" rx=\"9.4\" ry=\"4.4\" width=\"6\" height=\"16\" fill=\"#1d3f72\">\n                  <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.2222222222222222s\" repeatCount=\"indefinite\"></animate>\n                </rect>\n              </g><g transform=\"rotate(280 50 50)\">\n                <rect x=\"47\" y=\"22\" rx=\"9.4\" ry=\"4.4\" width=\"6\" height=\"16\" fill=\"#1d3f72\">\n                  <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.1111111111111111s\" repeatCount=\"indefinite\"></animate>\n                </rect>\n              </g><g transform=\"rotate(320 50 50)\">\n                <rect x=\"47\" y=\"22\" rx=\"9.4\" ry=\"4.4\" width=\"6\" height=\"16\" fill=\"#1d3f72\">\n                  <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"0s\" repeatCount=\"indefinite\"></animate>\n                </rect>\n              </g></svg>\n         </div>\n         <div style=\"float:left; margin: 16px 0 1px 3px\">\n            {{translatedMessages.loadingImage[language]}}\n         </div>\n         <div style=\"clear:both\"></div>\n        </div>\n        \n        <div [ngClass]=\"{'captcha-box-visible': state === 2, 'captcha-box-invisible': state !== 2}\">\n          <div>\n            <div style=\"float: left;\" #image class=\"captcha-image\"></div>\n            <audio #audioElement *ngIf=\"audio && audio.length > 0\" id=\"audioElement\" [src]=\"audio\">\n                {{translatedMessages.browserNotSupportAudio[language]}}\n            </audio>\n            <div style=\"float: left; margin-top: 8px\">\n              <a class=\"play-audio\" href=\"javascript:void(0)\" (click)=\"playAudio()\" role=\"button\">\n                <svg *ngIf=\"!fetchingAudioInProgress\" class=\"icon-play\"><use xlink:href=\"#icon-play-def\"></use></svg>\n                \n                <svg *ngIf=\"fetchingAudioInProgress\" class=\"lds-spinner\" width=\"15px\"  height=\"15px\"  xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"xMidYMid\" style=\"background: none;\"><g transform=\"rotate(0 50 50)\">\n                  <rect x=\"45\" y=\"9\" rx=\"2.7\" ry=\"0.54\" width=\"10\" height=\"22\" fill=\"#1d3f72\">\n                    <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.8888888888888888s\" repeatCount=\"indefinite\"></animate>\n                  </rect>\n                </g><g transform=\"rotate(40 50 50)\">\n                  <rect x=\"45\" y=\"9\" rx=\"2.7\" ry=\"0.54\" width=\"10\" height=\"22\" fill=\"#1d3f72\">\n                    <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.7777777777777778s\" repeatCount=\"indefinite\"></animate>\n                  </rect>\n                </g><g transform=\"rotate(80 50 50)\">\n                  <rect x=\"45\" y=\"9\" rx=\"2.7\" ry=\"0.54\" width=\"10\" height=\"22\" fill=\"#1d3f72\">\n                    <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.6666666666666666s\" repeatCount=\"indefinite\"></animate>\n                  </rect>\n                </g><g transform=\"rotate(120 50 50)\">\n                  <rect x=\"45\" y=\"9\" rx=\"2.7\" ry=\"0.54\" width=\"10\" height=\"22\" fill=\"#1d3f72\">\n                    <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.5555555555555556s\" repeatCount=\"indefinite\"></animate>\n                  </rect>\n                </g><g transform=\"rotate(160 50 50)\">\n                  <rect x=\"45\" y=\"9\" rx=\"2.7\" ry=\"0.54\" width=\"10\" height=\"22\" fill=\"#1d3f72\">\n                    <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.4444444444444444s\" repeatCount=\"indefinite\"></animate>\n                  </rect>\n                </g><g transform=\"rotate(200 50 50)\">\n                  <rect x=\"45\" y=\"9\" rx=\"2.7\" ry=\"0.54\" width=\"10\" height=\"22\" fill=\"#1d3f72\">\n                    <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.3333333333333333s\" repeatCount=\"indefinite\"></animate>\n                  </rect>\n                </g><g transform=\"rotate(240 50 50)\">\n                  <rect x=\"45\" y=\"9\" rx=\"2.7\" ry=\"0.54\" width=\"10\" height=\"22\" fill=\"#1d3f72\">\n                    <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.2222222222222222s\" repeatCount=\"indefinite\"></animate>\n                  </rect>\n                </g><g transform=\"rotate(280 50 50)\">\n                  <rect x=\"45\" y=\"9\" rx=\"2.7\" ry=\"0.54\" width=\"10\" height=\"22\" fill=\"#1d3f72\">\n                    <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"-0.1111111111111111s\" repeatCount=\"indefinite\"></animate>\n                  </rect>\n                </g><g transform=\"rotate(320 50 50)\">\n                  <rect x=\"45\" y=\"9\" rx=\"2.7\" ry=\"0.54\" width=\"10\" height=\"22\" fill=\"#1d3f72\">\n                    <animate attributeName=\"opacity\" values=\"1;0\" times=\"0;1\" dur=\"1s\" begin=\"0s\" repeatCount=\"indefinite\"></animate>\n                  </rect>\n                </g></svg>\n\n                {{translatedMessages.playAudio[language]}}\n              </a>\n              <div style=\"clear:both;\"></div>\n              \n              <a class=\"try-another-image\" href=\"javascript:void(0)\" (click)=\"retryFetchCaptcha()\" role=\"button\">\n                  <svg class=\"icon-loop icon-loop-def\"><use xlink:href=\"#icon-loop-def\"></use></svg>                \n                  {{translatedMessages.tryAnotherImg[language]}}\n              </a>\n            </div>\n          </div>\n          <div style=\"clear:both; margin-bottom: 8px;\"></div>\n          <div style=\"float:left;\">\n            <label for=\"answer\">\n                {{userPromptMessage || translatedMessages.userPromptMessage[language]}}\n              <input id=\"answer\" type=\"text\"\n                #userAnswerRef = \"ngModel\"\n                [(ngModel)]=\"answer\"\n                (input)=\"answerChanged($event)\"\n                [ngClass]=\"{'captcha-wrong-answer': userAnswerRef.dirty && incorrectAnswer}\"\n                name=\"answer\"\n                maxlength=\"6\"\n                required\n                autocorrect=\"off\" \n                autocapitalize=\"none\">\n            </label>\n          </div>\n        </div>\n        <div style=\"clear:both;\"></div>\n        <div style=\"float:left;\">\n\n        <div class=\"error-captcha\" *ngIf=\"state === 3\" role=\"alert\" aria-live=\"assertive\">\n          <div style=\"float:left; margin-left: 5px;\">\n            <svg class=\"icon-exclamation-triangle\"><use xlink:href=\"#icon-exclamation-triangle-def\"></use></svg>\n  \n            <span> {{translatedMessages.errorRetrievingImg[language].substring(0,translatedMessages.errorRetrievingImg[language].indexOf('{'))}} \n              <a href=\"javascript:void(0)\" (click)=\"retryFetchCaptcha()\">{{translatedMessages.errorRetrievingImg[language].substring(translatedMessages.errorRetrievingImg[language].lastIndexOf('{')+1,translatedMessages.errorRetrievingImg[language].indexOf('}'))}}</a> \n              {{translatedMessages.errorRetrievingImg[language].substring(translatedMessages.errorRetrievingImg[language].lastIndexOf('}')+1)}} \n            </span>\n          </div>\n          <div style=\"clear:both\"></div>\n          \n          <div style=\"float:left; margin-left: 25px;\">\n              {{errorFetchingImg}}\n          </div>\n          <div style=\"clear:both\"></div>\n        </div>\n        \n        <div class=\"spinner-box\" *ngIf=\"state == 4\" role=\"alert\" aria-live=\"assertive\">\n          <span>{{translatedMessages.verifyingAnswer[language]}}</span>\n        </div>\n        <div class=\"error-captcha\" *ngIf=\"state === 6\"  role=\"alert\" aria-live=\"assertive\">\n          <svg class=\"icon-exclamation-triangle\"><use xlink:href=\"#icon-exclamation-triangle-def\"></use></svg>\n          <span>{{translatedMessages.errorVerifyingAnswer[language].substring(0,translatedMessages.errorVerifyingAnswer[language].indexOf('{'))}} \n              <a href=\"javascript:void(0)\" (click)=\"retryFetchCaptcha()\">{{translatedMessages.errorVerifyingAnswer[language].substring(translatedMessages.errorVerifyingAnswer[language].lastIndexOf('{')+1,translatedMessages.errorVerifyingAnswer[language].indexOf('}'))}}</a> \n              {{translatedMessages.errorVerifyingAnswer[language].substring(translatedMessages.errorVerifyingAnswer[language].lastIndexOf('}')+1)}} \n          </span>\n          <p>\n          </p>\n        </div>\n        \n        <div class=\"captcha-error\" style=\"margin-top: 2px\" *ngIf=\"incorrectAnswer === true\" role=\"alert\" aria-live=\"assertive\">\n          {{translatedMessages.incorrectAnswer[language]}}\n        </div>\n      </div>\n      \n      </div>\n    </div>\n  </form>\n\n  <div class=\"confirm-correct-answer\" style=\"float:left\" *ngIf=\"state === 5\" role=\"alert\" aria-live=\"assertive\">\n    <svg class=\"icon-check\"><use xlink:href=\"#icon-check-def\"></use></svg>\n    {{translatedMessages.correct[language]}} <span>{{successMessage || translatedMessages.successMessage[language]}}</span>\n  </div>\n  <div style=\"clear:both;\"></div>\n</div>\n",
                styles: [".bcgov-captcha .confirm-correct-answer{display:block;color:green}.bcgov-captcha .confirm-correct-answer i{color:green}.bcgov-captcha .spinner-box{height:60px;margin:2px 10px 6px;padding:5px 10px 5px 18px}.bcgov-captcha .error-captcha{margin-left:10px}.bcgov-captcha .error-captcha svg{color:#ff8c00}.bcgov-captcha .error-captcha p{margin-left:32px}.bcgov-captcha .captcha-box-visible{display:block}.bcgov-captcha .captcha-box-invisible{display:none}.bcgov-captcha .captcha-image{display:inline-block;border:1px solid gray}.bcgov-captcha .play-audio{float:left;display:block;margin-left:5px;margin-bottom:3px}.bcgov-captcha .try-another-image{display:inline-block;margin-left:5px}.bcgov-captcha .has-error{border-color:#dc3545}.bcgov-captcha .has-error:focus{box-shadow:0 0 0 .2rem rgba(220,53,69,.25)}.bcgov-captcha input[type=text]{display:block;margin:0;width:100%;font-size:20px;box-shadow:none;border-radius:none;padding:6px;border:1px solid #ccc;transition:box-shadow .3s,border .3s}.bcgov-captcha input[type=text]:focus{border:1px solid #fff;box-shadow:0 0 1px 1px #2196f3;outline:0}.bcgov-captcha input[type=text].captcha-wrong-answer{border:1px solid #a94442}.bcgov-captcha .captcha-error{color:#a94442}.bcgov-captcha .icon-check,.bcgov-captcha .icon-exclamation-triangle,.bcgov-captcha .icon-loop,.bcgov-captcha .icon-play{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor}.bcgov-captcha .spinner{-webkit-animation:1.4s linear infinite rotator;animation:1.4s linear infinite rotator}@-webkit-keyframes rotator{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(270deg);transform:rotate(270deg)}}@keyframes rotator{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(270deg);transform:rotate(270deg)}}.bcgov-captcha .path{stroke-dasharray:187;stroke-dashoffset:0;-webkit-transform-origin:center;transform-origin:center;-webkit-animation:1.4s ease-in-out infinite dash,5.6s ease-in-out infinite colors;animation:1.4s ease-in-out infinite dash,5.6s ease-in-out infinite colors}@-webkit-keyframes colors{0%{stroke:#9e9e9e}25%{stroke:#757575}50%{stroke:#616161}75%{stroke:#424242}100%{stroke:#212121}}@keyframes colors{0%{stroke:#9e9e9e}25%{stroke:#757575}50%{stroke:#616161}75%{stroke:#424242}100%{stroke:#212121}}@-webkit-keyframes dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;-webkit-transform:rotate(135deg);transform:rotate(135deg)}100%{stroke-dashoffset:187;-webkit-transform:rotate(450deg);transform:rotate(450deg)}}@keyframes dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;-webkit-transform:rotate(135deg);transform:rotate(135deg)}100%{stroke-dashoffset:187;-webkit-transform:rotate(450deg);transform:rotate(450deg)}}"]
            }] }
];
/** @nocollapse */
CaptchaComponent.ctorParameters = () => [
    { type: CaptchaDataService },
    { type: ChangeDetectorRef },
    { type: NgZone }
];
CaptchaComponent.propDecorators = {
    imageContainer: [{ type: ViewChild, args: ['image',] }],
    audioElement: [{ type: ViewChild, args: ['audioElement',] }],
    apiBaseUrl: [{ type: Input, args: ['apiBaseUrl',] }],
    nonce: [{ type: Input, args: ['nonce',] }],
    onValidToken: [{ type: Output }],
    successMessage: [{ type: Input, args: ['successMessage',] }],
    eagerFetchAudio: [{ type: Input, args: ['eagerFetchAudio',] }],
    language: [{ type: Input, args: ['language',] }],
    userPromptMessage: [{ type: Input, args: ['userPromptMessage',] }]
};
if (false) {
    /** @type {?} */
    CaptchaComponent.prototype.imageContainer;
    /** @type {?} */
    CaptchaComponent.prototype.audioElement;
    /** @type {?} */
    CaptchaComponent.prototype.apiBaseUrl;
    /** @type {?} */
    CaptchaComponent.prototype.nonce;
    /** @type {?} */
    CaptchaComponent.prototype.onValidToken;
    /** @type {?} */
    CaptchaComponent.prototype.successMessage;
    /** @type {?} */
    CaptchaComponent.prototype.eagerFetchAudio;
    /** @type {?} */
    CaptchaComponent.prototype.language;
    /** @type {?} */
    CaptchaComponent.prototype.userPromptMessage;
    /**
     * Http error response for fetching a CAPTCHA image.
     * @type {?}
     */
    CaptchaComponent.prototype.errorFetchingImg;
    /**
     * Http error response for verifying user's answer.
     * @type {?}
     */
    CaptchaComponent.prototype.errorVerifyAnswer;
    /**
     * @type {?}
     * @private
     */
    CaptchaComponent.prototype.validation;
    /** @type {?} */
    CaptchaComponent.prototype.audio;
    /** @type {?} */
    CaptchaComponent.prototype.answer;
    /** @type {?} */
    CaptchaComponent.prototype.state;
    /** @type {?} */
    CaptchaComponent.prototype.incorrectAnswer;
    /** @type {?} */
    CaptchaComponent.prototype.fetchingAudioInProgress;
    /** @type {?} */
    CaptchaComponent.prototype.translatedMessages;
    /**
     * @type {?}
     * @private
     */
    CaptchaComponent.prototype.dataService;
    /**
     * @type {?}
     * @private
     */
    CaptchaComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    CaptchaComponent.prototype.ngZone;
}
/** @enum {number} */
const CAPTCHA_STATE = {
    FETCHING_CAPTCHA_IMG: 1,
    SUCCESS_FETCH_IMG: 2,
    ERROR_FETCH_IMG: 3,
    VERIFYING_ANSWER: 4,
    SUCCESS_VERIFY_ANSWER_CORRECT: 5,
    // http error during verification call.
    ERROR_VERIFY: 6,
};
CAPTCHA_STATE[CAPTCHA_STATE.FETCHING_CAPTCHA_IMG] = 'FETCHING_CAPTCHA_IMG';
CAPTCHA_STATE[CAPTCHA_STATE.SUCCESS_FETCH_IMG] = 'SUCCESS_FETCH_IMG';
CAPTCHA_STATE[CAPTCHA_STATE.ERROR_FETCH_IMG] = 'ERROR_FETCH_IMG';
CAPTCHA_STATE[CAPTCHA_STATE.VERIFYING_ANSWER] = 'VERIFYING_ANSWER';
CAPTCHA_STATE[CAPTCHA_STATE.SUCCESS_VERIFY_ANSWER_CORRECT] = 'SUCCESS_VERIFY_ANSWER_CORRECT';
CAPTCHA_STATE[CAPTCHA_STATE.ERROR_VERIFY] = 'ERROR_VERIFY';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FwdGNoYS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9tb2gtY29tbW9uLWxpYi9jYXB0Y2hhLyIsInNvdXJjZXMiOlsiY2FwdGNoYS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBaUIsTUFBTSxFQUN2RCxpQkFBaUIsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFvQyxZQUFZLEVBQ2pGLE1BQU0sZUFBZSxDQUFDO0FBR3ZCLE9BQU8sRUFBRSxrQkFBa0IsRUFBaUIsTUFBTSx3QkFBd0IsQ0FBQztBQU8zRSxNQUFNLE9BQU8sZ0JBQWdCOzs7Ozs7SUFpQzNCLFlBQW9CLFdBQStCLEVBQ3pDLEVBQXFCLEVBQ3JCLE1BQWM7UUFGSixnQkFBVyxHQUFYLFdBQVcsQ0FBb0I7UUFDekMsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFDckIsV0FBTSxHQUFOLE1BQU0sQ0FBUTs7UUEzQmQsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO1FBR2pDLGFBQVEsR0FBVyxJQUFJLENBQUM7Ozs7UUFNM0MscUJBQWdCLEdBQUcsSUFBSSxDQUFDOzs7O1FBS3hCLHNCQUFpQixHQUFHLElBQUksQ0FBQztRQUVqQixlQUFVLEdBQUcsRUFBRSxDQUFDO1FBQ2pCLFVBQUssR0FBRyxFQUFFLENBQUM7UUFDWCxXQUFNLEdBQUcsRUFBRSxDQUFDO1FBS1osNEJBQXVCLEdBQUcsS0FBSyxDQUFDOztRQTJMaEMsdUJBQWtCLEdBQUc7WUFDMUIsU0FBUyxFQUFFO2dCQUNULEVBQUUsRUFBRSxZQUFZO2dCQUNoQixFQUFFLEVBQUUsTUFBTTtnQkFDVixFQUFFLEVBQUUsZUFBZTtnQkFDbkIsRUFBRSxFQUFFLFdBQVc7YUFDaEI7WUFDRCxhQUFhLEVBQUU7Z0JBQ2IsRUFBRSxFQUFFLG1CQUFtQjtnQkFDdkIsRUFBRSxFQUFFLE1BQU07Z0JBQ1YsRUFBRSxFQUFFLHlCQUF5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cUI7O0lBQ3JCLDJDQUF5Qjs7SUFFekIsbURBQXVDOztJQTJMdkMsOENBbUVFOzs7OztJQTVQVSx1Q0FBdUM7Ozs7O0lBQ2pELDhCQUE2Qjs7Ozs7SUFDN0Isa0NBQXNCOzs7O0lBa1F4Qix1QkFBd0I7SUFDeEIsb0JBQXFCO0lBQ3JCLGtCQUFtQjtJQUNuQixtQkFBb0I7SUFDcEIsZ0NBQWlDO0lBQ2pDLHVDQUF1QztJQUN2QyxlQUFnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCwgRWxlbWVudFJlZiwgVmlld0NoaWxkLCBTaW1wbGVDaGFuZ2VzLCBOZ1pvbmUsXG4gIENoYW5nZURldGVjdG9yUmVmLCBPdXRwdXQsIElucHV0LCBBZnRlclZpZXdJbml0LCBPbkluaXQsIE9uQ2hhbmdlcywgRXZlbnRFbWl0dGVyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuLy8gaW1wb3J0IHsgSHR0cCwgUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9odHRwJztcbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBSZXNwb25zZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IENhcHRjaGFEYXRhU2VydmljZSwgU2VydmVyUGF5bG9hZCB9IGZyb20gJy4vY2FwdGNoYS1kYXRhLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjb21tb24tY2FwdGNoYScsXG4gIHRlbXBsYXRlVXJsOiAnLi9jYXB0Y2hhLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vY2FwdGNoYS5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIENhcHRjaGFDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkluaXQsIE9uQ2hhbmdlcyB7XG5cbiAgQFZpZXdDaGlsZCgnaW1hZ2UnKSBpbWFnZUNvbnRhaW5lcjogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnYXVkaW9FbGVtZW50JykgYXVkaW9FbGVtZW50OiBFbGVtZW50UmVmO1xuICAvLyB0c2xpbnQ6ZGlzYWJsZTpuby1pbnB1dC1yZW5hbWVcbiAgQElucHV0KCdhcGlCYXNlVXJsJykgYXBpQmFzZVVybDogc3RyaW5nO1xuICBASW5wdXQoJ25vbmNlJykgbm9uY2U6IHN0cmluZztcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW91dHB1dC1vbi1wcmVmaXhcbiAgQE91dHB1dCgpIG9uVmFsaWRUb2tlbiA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nPigpO1xuICBASW5wdXQoJ3N1Y2Nlc3NNZXNzYWdlJykgc3VjY2Vzc01lc3NhZ2U6IHN0cmluZztcbiAgQElucHV0KCdlYWdlckZldGNoQXVkaW8nKSBlYWdlckZldGNoQXVkaW86IHN0cmluZztcbiAgQElucHV0KCdsYW5ndWFnZScpIGxhbmd1YWdlOiBzdHJpbmcgPSAnZW4nO1xuICBASW5wdXQoJ3VzZXJQcm9tcHRNZXNzYWdlJykgdXNlclByb21wdE1lc3NhZ2U6IHN0cmluZztcblxuICAvKipcbiAgICogSHR0cCBlcnJvciByZXNwb25zZSBmb3IgZmV0Y2hpbmcgYSBDQVBUQ0hBIGltYWdlLlxuICAgKi9cbiAgZXJyb3JGZXRjaGluZ0ltZyA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEh0dHAgZXJyb3IgcmVzcG9uc2UgZm9yIHZlcmlmeWluZyB1c2VyJ3MgYW5zd2VyLlxuICAgKi9cbiAgZXJyb3JWZXJpZnlBbnN3ZXIgPSBudWxsO1xuXG4gIHByaXZhdGUgdmFsaWRhdGlvbiA9ICcnO1xuICBwdWJsaWMgYXVkaW8gPSAnJztcbiAgcHVibGljIGFuc3dlciA9ICcnO1xuXG4gIHN0YXRlOiBDQVBUQ0hBX1NUQVRFO1xuICBpbmNvcnJlY3RBbnN3ZXI6IGJvb2xlYW47XG5cbiAgcHVibGljIGZldGNoaW5nQXVkaW9JblByb2dyZXNzID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBkYXRhU2VydmljZTogQ2FwdGNoYURhdGFTZXJ2aWNlLFxuICAgIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmUpIHtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuZm9yY2VSZWZyZXNoLmJpbmQodGhpcyk7XG4gICAgd2luZG93WydjYS5iY2dvdi5jYXB0Y2hhUmVmcmVzaCddID0gdGhpcy5wdWJsaWNGb3JjZVJlZnJlc2guYmluZCh0aGlzKTtcblxuICAgIC8vIGlmKCF0aGlzLnVzZXJQcm9tcHRNZXNzYWdlKXtcbiAgICAvLyAgIHRoaXMudXNlclByb21wdE1lc3NhZ2UgPSBcIkVudGVyIHRoZSB0ZXh0IHlvdSBlaXRoZXIgc2VlIGluIHRoZSBib3ggb3IgeW91IGhlYXIgaW4gdGhlIGF1ZGlvXCI7XG4gICAgLy8gfVxuICB9XG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLmZvcmNlUmVmcmVzaCgpO1xuICB9XG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAvLyB3aGVuIGNoYW5naW5nIGxhbmd1YWdlLCBpZiBhdWRpbyBpcyBlbXB0eSB0aGVuIG5vIG5lZWQgdG8gcmVmZXRjaFxuICAgIGlmICghY2hhbmdlcy5sYW5ndWFnZSB8fCAhdGhpcy5hdWRpbyB8fCB0aGlzLmF1ZGlvLmxlbmd0aCA9PT0gMCkge1xuICAgICAgaWYgKCEoY2hhbmdlcy5yZWxvYWRDYXB0Y2hhICYmICh0cnVlID09PSBjaGFuZ2VzLnJlbG9hZENhcHRjaGEucHJldmlvdXNWYWx1ZVxuICAgICAgICB8fCBmYWxzZSA9PT0gY2hhbmdlcy5yZWxvYWRDYXB0Y2hhLnByZXZpb3VzVmFsdWUpXG4gICAgICAgICYmIChjaGFuZ2VzLnJlbG9hZENhcHRjaGEuY3VycmVudFZhbHVlICE9PSBjaGFuZ2VzLnJlbG9hZENhcHRjaGEucHJldmlvdXNWYWx1ZSkpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5nZXROZXdDYXB0Y2hhKGZhbHNlKTtcbiAgfVxuXG4gIGZvcmNlUmVmcmVzaCgpIHtcbiAgICB0aGlzLmdldE5ld0NhcHRjaGEoZmFsc2UpO1xuICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG5cbiAgcHVibGljRm9yY2VSZWZyZXNoKCkge1xuICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB0aGlzLmZvcmNlUmVmcmVzaCgpKTtcbiAgfVxuXG4gIGFuc3dlckNoYW5nZWQoZXZlbnQ6IGFueSkge1xuICAgIGlmICh0aGlzLmFuc3dlci5sZW5ndGggPCA2KSB7XG4gICAgICB0aGlzLmluY29ycmVjdEFuc3dlciA9IG51bGw7XG4gICAgfVxuICAgIGlmICh0aGlzLmFuc3dlci5sZW5ndGggPT09IDYpIHtcbiAgICAgIHRoaXMuc3RhdGUgPSBDQVBUQ0hBX1NUQVRFLlZFUklGWUlOR19BTlNXRVI7XG4gICAgICB0aGlzLmluY29ycmVjdEFuc3dlciA9IG51bGw7XG4gICAgICB0aGlzLmRhdGFTZXJ2aWNlLnZlcmlmeUNhcHRjaGEodGhpcy5hcGlCYXNlVXJsLCB0aGlzLm5vbmNlLCB0aGlzLmFuc3dlciwgdGhpcy52YWxpZGF0aW9uKS5zdWJzY3JpYmUocmVzcG9uc2UgPT4ge1xuICAgICAgICBjb25zdCBwYXlsb2FkID0gcmVzcG9uc2UuYm9keTtcbiAgICAgICAgaWYgKHRoaXMuaXNWYWxpZFBheWxvYWQocGF5bG9hZCkpIHtcbiAgICAgICAgICB0aGlzLmhhbmRsZVZlcmlmeShwYXlsb2FkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnN0YXRlID0gQ0FQVENIQV9TVEFURS5FUlJPUl9WRVJJRlk7XG4gICAgICAgICAgdGhpcy5lcnJvclZlcmlmeUFuc3dlciA9IHRoaXMuY3JlYXRlRXJyb3JUZXh0TGluZShyZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIHRoaXMuc3RhdGUgPSBDQVBUQ0hBX1NUQVRFLkVSUk9SX1ZFUklGWTtcbiAgICAgICAgICB0aGlzLmVycm9yVmVyaWZ5QW5zd2VyID0gdGhpcy5jcmVhdGVFcnJvclRleHRMaW5lKGVycm9yKTtcbiAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3IgcmVzcG9uc2UgZnJvbSB2ZXJpZnlpbmcgdXNlciBhbnN3ZXI6ICVvJywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8vIENhbGwgdGhlIGJhY2tlbmQgdG8gc2VlIGlmIG91ciBhbnN3ZXIgaXMgY29ycmVjdFxuICBwcml2YXRlIGhhbmRsZVZlcmlmeShwYXlsb2FkOiBhbnkpIHtcbiAgICAvLyBUaGVyZSBjb3VsZCBiZSB0aGUgcmFyZSBjaGFuZ2Ugd2hlcmUgYW4gaW52YWxpZCBwYXlsb2FkIHJlc3BvbnNlIGlzIHJlY2VpdmVkLlxuICAgIGlmIChwYXlsb2FkLnZhbGlkID09PSB0cnVlKSB7XG4gICAgICB0aGlzLnN0YXRlID0gQ0FQVENIQV9TVEFURS5TVUNDRVNTX1ZFUklGWV9BTlNXRVJfQ09SUkVDVDtcbiAgICAgIHRoaXMub25WYWxpZFRva2VuLmVtaXQocGF5bG9hZC5qd3QpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmluY29ycmVjdEFuc3dlciA9IHRydWU7XG4gICAgICB0aGlzLmFuc3dlciA9ICcnO1xuICAgICAgdGhpcy5hdWRpbyA9ICcnO1xuICAgICAgLy8gVGhleSBmYWlsZWQgLSB0cnkgYSBuZXcgb25lLlxuICAgICAgdGhpcy5nZXROZXdDYXB0Y2hhKHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDYXNlIHdoZXJlIEhUVFAgMjAwIHJlc3BvbnNlIGNvZGUgaXMgcmVjZWl2ZWQgYnkgdGhlIHBheWxvYWQgaXMgaW5jb3JyZWN0IG9yIGNvcnJ1cHQuXG4gICAqIFRoZSBvY2N1cmFuY2Ugb2YgdGhpcyB0eXBlIG9mIGNhc2Ugc2hvdWxkIGJlIHJhcmUuXG4gICAqIEBwYXJhbSBwYXlsb2FkXG4gICAqL1xuICBwcml2YXRlIGlzVmFsaWRQYXlsb2FkKHBheWxvYWQpIHtcbiAgICAvLyBjb25zb2xlLmRlYnVnKCdSZXNwb25zZSBwYXlsb2FkOiAlbycsIHBheWxvYWQpO1xuICAgIGlmICghcGF5bG9hZCkge1xuICAgICAgY29uc29sZS5lcnJvcigncGF5bG9hZCBjYW5ub3QgYmUgbnVsbCBvciB1bmRlZmluZWQgb3IgMCcpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBoYXNWYWx1ZVByb3AgPSBwYXlsb2FkLmhhc093blByb3BlcnR5KCd2YWxpZCcpO1xuICAgICAgaWYgKCFoYXNWYWx1ZVByb3ApIHtcbiAgICAgICAgY29uc29sZS5lcnJvcigncGF5bG9hZCBtdXN0IGhhdmUgaXRzIG93biBwcm9wZXJ0eSBuYW1lZCBcXCd2YWxpZFxcJycpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwdWJsaWMgcmV0cnlGZXRjaENhcHRjaGEoKSB7XG4gICAgY29uc29sZS5sb2coJ1JldHJ5IGNhcHRjaGEnKTtcbiAgICB0aGlzLnN0YXRlID0gdW5kZWZpbmVkO1xuXG4gICAgLyoqXG4gICAgICogd2FpdCBmb3IgMC41IHNlb25kIGJlZm9yZSByZXN1Ym1pdHRpbmdcbiAgICAgKi9cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuZ2V0TmV3Q2FwdGNoYShmYWxzZSk7XG4gICAgfSwgMTAwKTtcbiAgfVxuXG4gIHB1YmxpYyBwbGF5QXVkaW8oKSB7XG4gICAgaWYgKHRoaXMuYXVkaW8gJiYgdGhpcy5hdWRpby5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLmF1ZGlvRWxlbWVudC5uYXRpdmVFbGVtZW50LnBsYXkoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5mZXRjaEF1ZGlvKHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZmV0Y2hBdWRpbyhwbGF5SW1tZWRpYXRlbHk6IGJvb2xlYW4gPSBmYWxzZSkge1xuICAgIGlmICghdGhpcy5mZXRjaGluZ0F1ZGlvSW5Qcm9ncmVzcykge1xuICAgICAgdGhpcy5mZXRjaGluZ0F1ZGlvSW5Qcm9ncmVzcyA9IHRydWU7XG4gICAgICB0aGlzLmRhdGFTZXJ2aWNlLmZldGNoQXVkaW8odGhpcy5hcGlCYXNlVXJsLCB0aGlzLnZhbGlkYXRpb24sIHRoaXMubGFuZ3VhZ2UpLnN1YnNjcmliZSgocmVzcG9uc2U6IEh0dHBSZXNwb25zZTxhbnk+KSA9PiB7XG4gICAgICAgIHRoaXMuZmV0Y2hpbmdBdWRpb0luUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hdWRpbyA9IHJlc3BvbnNlLmJvZHkuYXVkaW87XG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICBpZiAocGxheUltbWVkaWF0ZWx5KSB7XG4gICAgICAgICAgdGhpcy5hdWRpb0VsZW1lbnQubmF0aXZlRWxlbWVudC5wbGF5KCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIHRoaXMuZmV0Y2hpbmdBdWRpb0luUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3IgcmVzcG9uc2UgZnJvbSBmZXRjaGluZyBhdWRpbyBDQVBUQ0hBOiAlbycsIGVycm9yKTtcbiAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0TmV3Q2FwdGNoYShlcnJvckNhc2U6IGFueSkge1xuICAgIHRoaXMuc3RhdGUgPSBDQVBUQ0hBX1NUQVRFLkZFVENISU5HX0NBUFRDSEFfSU1HO1xuICAgIHRoaXMuYXVkaW8gPSAnJztcblxuICAgIC8vIFJlc2V0IHRoaW5nc1xuICAgIGlmICghZXJyb3JDYXNlKSB7XG4gICAgICAvLyBMZXQgdGhlbSBrbm93IHRoZXkgZmFpbGVkIGluc3RlYWQgb2Ygd2lwaW5nIG91dCB0aGUgYW5zd2VyIGFyZWFcbiAgICAgIC8vIENvbnRydWN0aW5nIHRoaXMgZm9ybSBvbiBwYWdlIGxvYWQvcmVsb2FkIHdpbGwgaGF2ZSBlcnJvckNhc2UgPSBmYWxzZVxuICAgICAgdGhpcy5pbmNvcnJlY3RBbnN3ZXIgPSBudWxsO1xuICAgIH1cblxuXG4gICAgdGhpcy5kYXRhU2VydmljZS5mZXRjaERhdGEodGhpcy5hcGlCYXNlVXJsLCB0aGlzLm5vbmNlKS5zdWJzY3JpYmUocmVzcG9uc2UgPT4ge1xuICAgICAgdGhpcy5zdGF0ZSA9IENBUFRDSEFfU1RBVEUuU1VDQ0VTU19GRVRDSF9JTUc7XG5cbiAgICAgIGNvbnN0IHBheWxvYWQgPSByZXNwb25zZS5ib2R5O1xuICAgICAgdGhpcy5pbWFnZUNvbnRhaW5lci5uYXRpdmVFbGVtZW50LmlubmVySFRNTCA9IHBheWxvYWQuY2FwdGNoYTtcbiAgICAgIHRoaXMudmFsaWRhdGlvbiA9IHBheWxvYWQudmFsaWRhdGlvbjtcbiAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuXG4gICAgICBpZiAodGhpcy5lYWdlckZldGNoQXVkaW8gPT09ICd0cnVlJykge1xuICAgICAgICAvLyBjb25zb2xlLmxvZygnRmV0Y2ggYXVkaW8gZWFnZXJseScpO1xuICAgICAgICB0aGlzLmZldGNoQXVkaW8oKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdOb3QgdG8gZmV0Y2ggYXVkaW8gZWFnZXJseScpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICB0aGlzLnN0YXRlID0gQ0FQVENIQV9TVEFURS5FUlJPUl9GRVRDSF9JTUc7XG4gICAgICAgIHRoaXMuZXJyb3JGZXRjaGluZ0ltZyA9IHRoaXMuY3JlYXRlRXJyb3JUZXh0TGluZShlcnJvcik7XG4gICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBlc3BvbnNlIGZyb20gZmV0Y2hpbmcgQ0FQVENIQSB0ZXh0OiAlbycsIGVycm9yKTtcbiAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlRXJyb3JUZXh0TGluZShlcnJvcikge1xuXG4gICAgbGV0IGxpbmUgPSAnRXJyb3Igc3RhdHVzOiAnICsgZXJyb3Iuc3RhdHVzO1xuICAgIGlmIChlcnJvci5zdGF0dXNUZXh0KSB7XG4gICAgICBsaW5lID0gbGluZSArICcsIHN0YXR1cyB0ZXh0OiAnICsgZXJyb3Iuc3RhdHVzVGV4dDtcbiAgICB9XG4gICAgcmV0dXJuIGxpbmU7XG4gIH1cblxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWVtYmVyLW9yZGVyaW5nXG4gIHB1YmxpYyB0cmFuc2xhdGVkTWVzc2FnZXMgPSB7XG4gICAgcGxheUF1ZGlvOiB7XG4gICAgICBlbjogJ1BsYXkgQXVkaW8nLFxuICAgICAgemg6ICfmkq3mlL7lo7Dpn7MnLFxuICAgICAgZnI6ICdMZWN0dXJlIGF1ZGlvJyxcbiAgICAgIHBhOiAn4KiG4Kih4KmA4KiTIOComuCosuCovuCokycsXG4gICAgfSxcbiAgICB0cnlBbm90aGVySW1nOiB7XG4gICAgICBlbjogJ1RyeSBhbm90aGVyIGltYWdlJyxcbiAgICAgIHpoOiAn5o2i5Liq5Zu+5YOPJyxcbiAgICAgIGZyOiAnRXNzYXlleiB1bmUgYXV0cmUgaW1hZ2UnLFxuICAgICAgcGE6ICfgqJXgqYvgqIgg4Ki54KmL4KiwIOComuCov+CpseCopOCosCDgqIXgqJzgqLzgqK7gqL7gqJMnLFxuICAgIH0sXG4gICAgdXNlclByb21wdE1lc3NhZ2U6IHtcbiAgICAgIGVuOiAnRW50ZXIgdGhlIHRleHQgeW91IGVpdGhlciBzZWUgaW4gdGhlIGJveCBvciB5b3UgaGVhciBpbiB0aGUgYXVkaW8nLFxuICAgICAgemg6ICfor7fovpPlhaXnnIvliLDmiJblkKzliLDnmoTmloflrZcnLFxuICAgICAgZnI6ICdFbnRyZXogbGUgdGV4dGUgcXVlIHZvdXMgdm95ZXogZGFucyBsYSBjYXNlIG91IHF1ZSB2b3VzIGVudGVuZGV6IGRhbnMgbGUgc29uJyxcbiAgICAgIHBhOiAn4KiJ4Ki5IOCon+CpiOColeCouOConyDgqKbgqL7gqJbgqLIg4KiV4Kiw4KmLIOConOCpiyDgqKTgqYHgqLjgqYDgqIIg4Kis4KiV4Ki44KmHIOCoteCov+CpseComiDgqKbgqYfgqJbgqKbgqYcg4Ki54KmLIOConOCovuCogiDgqKTgqYHgqLjgqYDgqIIg4KiG4Kih4KmA4KiTIOCoteCov+CpseComiDgqLjgqYHgqKPgqKbgqYcg4Ki54KmLJyxcbiAgICB9LFxuICAgIGluY29ycmVjdEFuc3dlcjoge1xuICAgICAgZW46ICdJbmNvcnJlY3QgYW5zd2VyLCBwbGVhc2UgdHJ5IGFnYWluLicsXG4gICAgICB6aDogJ+etlOahiOS4jeWvueOAguivt+mHjeivleOAgicsXG4gICAgICBmcjogJ01hdXZhaXNlIHLDqXBvbnNlLCB2ZXVpbGxleiByw6llc3NheWVyLicsXG4gICAgICBwYTogJ+Col+CosuCopCDgqJzgqLXgqL7gqKwsIOColeCov+CosOCoquCoviDgqJXgqLDgqJXgqYcg4Kim4KmB4Kis4Ki+4Kiw4Ki+IOColeCpi+CouOCovOCov+CouOCovCDgqJXgqLDgqYsuJyxcbiAgICB9LFxuICAgIHN1Y2Nlc3NNZXNzYWdlOiB7XG4gICAgICBlbjogJ1lvdSBjYW4gc3VibWl0IHlvdXIgYXBwbGljYXRpb24gbm93LicsXG4gICAgICB6aDogJ+S9oOeOsOWcqOWPr+S7peaPkOS6pOeUs+ivt+S6huOAgicsXG4gICAgICBmcjogJ1ZvdXMgcG91dmV6IHNvdW1ldHRyZSB2b3RyZSBjYW5kaWRhdHVyZSBtYWludGVuYW50LicsXG4gICAgICBwYTogJ+CopOCpgeCouOCpgOCogiDgqIbgqKrgqKPgqYAg4KiF4Kiw4Kic4Ki84KmAIOCoueCpgeCoo+CphyDgqKrgqYfgqLjgqLwg4KiV4KiwIOCouOColeCopuCphyDgqLngqYsnLFxuICAgIH0sXG4gICAgY29ycmVjdDoge1xuICAgICAgZW46ICdDb3JyZWN0LicsXG4gICAgICB6aDogJ+ato+ehruOAgicsXG4gICAgICBmcjogJ0NvcnJlY3QuJyxcbiAgICAgIHBhOiAn4Ki44Ki54KmAIOColeCosOCpiycsXG4gICAgfSxcbiAgICBsb2FkaW5nSW1hZ2U6IHtcbiAgICAgIGVuOiAnTG9hZGluZyBDQVBUQ0hBIGltYWdlJyxcbiAgICAgIHpoOiAn5q2j5Zyo5LiL6L296aqM6K+B56CBJyxcbiAgICAgIGZyOiAnQ2hhcmdlbWVudCBkZSBsXFwnaW1hZ2UgQ0FQVENIQScsXG4gICAgICBwYTogJ+ColeCpiOCoquCon+ComuCoviDgqJrgqL/gqbHgqKTgqLAg4Kiy4KmL4KihIOColeCosCDgqLDgqL/gqLngqL4g4Ki54KmIJyxcbiAgICB9LFxuICAgIGJyb3dzZXJOb3RTdXBwb3J0QXVkaW86IHtcbiAgICAgIGVuOiAnWW91ciBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgdGhlIGF1ZGlvIGVsZW1lbnQuJyxcbiAgICAgIHpoOiAn5L2g55qE5rWP6KeI5Zmo5LiN5pSv5oyB5pKt6Z+zJyxcbiAgICAgIGZyOiAnVm90cmUgbmF2aWdhdGV1ciBuZSBzdXBwb3J0ZSBwYXMgbFxcJ8OpbMOpbWVudCBhdWRpby4nLFxuICAgICAgcGE6ICfgqKTgqYHgqLngqL7gqKHgqL4g4Kis4KmN4Kiw4Ki+4KiJ4Kic4Ki84KiwIOCohuCooeCpgOCokyDgqJDgqLLgqYDgqK7gqYjgqILgqJ8g4Kim4Ki+IOCouOCoruCosOCopeCoqCDgqKjgqLngqYDgqIIg4KiV4Kiw4Kim4Ki+LicsXG4gICAgfSxcbiAgICB2ZXJpZnlpbmdBbnN3ZXI6IHtcbiAgICAgIGVuOiAnVmVyaWZ5aW5nIHlvdXIgYW5zd2VyLi4uJyxcbiAgICAgIHpoOiAn5q2j5Zyo6aqM6K+B562U5qGILi4uJyxcbiAgICAgIGZyOiAnVsOpcmlmaWNhdGlvbiBkZSB2b3RyZSByw6lwb25zZSAuLi4nLFxuICAgICAgcGE6ICfgqKTgqYHgqLngqL7gqKHgqL4g4Kic4Ki14Ki+4KisIOCopOCouOCopuCpgOColSDgqJXgqLAg4Kiw4Ki/4Ki54Ki+IOCoueCpiCAuLi4nLFxuICAgIH0sXG4gICAgZXJyb3JSZXRyaWV2aW5nSW1nOiB7XG4gICAgICBlbjogJ0Vycm9yIGhhcHBlbmVkIHdoaWxlIHJldHJpZXZpbmcgQ0FQVENIQSBpbWFnZS4gcGxlYXNlIHt7Y2xpY2sgaGVyZX19IHRvIHRyeSBhZ2FpbicsXG4gICAgICB6aDogJ+mqjOivgeeggeS4i+i9vemUmeivr+OAguivt3t754K55Ye76L+Z6YeMfX3ph43or5UnLFxuICAgICAgZnI6ICdVbmUgZXJyZXVyIHNcXCdlc3QgcHJvZHVpdGUgbG9ycyBkZSBsYSByw6ljdXDDqXJhdGlvbiBkZSBsXFwnaW1hZ2UgQ0FQVENIQS4gc1xcJ2lsIHZvdXMgcGxhw650IHt7Y2xpcXVleiBpY2l9fSBwb3VyIHLDqWVzc2F5ZXInLFxuICAgICAgcGE6ICfgqJXgqYjgqKrgqJ/gqJrgqL4g4Kia4Ki/4Kmx4Kik4KiwIOCoqOCpguCpsCDgqKrgqY3gqLDgqL7gqKrgqKQg4KiV4Kiw4Kim4KmHIOCouOCoruCph+CogiDgqKTgqLDgqYHgqbHgqJ/gqYAg4KiJ4Kik4Kiq4Kmw4KioIOCoueCpi+CoiC4g4KiV4Ki/4Kiw4Kiq4Ki+IOColeCosOColeCphyDgqKbgqYHgqKzgqL7gqLDgqL4g4KiV4KmL4Ki44Ki84Ki/4Ki44Ki8IOColeCosOCoqCDgqLLgqIgge3vgqIfgqbHgqKXgqYcg4KiV4Kiy4Ki/4KiVIOColeCosOCpi319JyxcbiAgICB9LFxuICAgIGVycm9yVmVyaWZ5aW5nQW5zd2VyOiB7XG4gICAgICBlbjogJ0Vycm9yIGhhcHBlbmVkIHdoaWxlIHZlcmlmeWluZyB5b3VyIGFuc3dlci4gcGxlYXNlIHt7Y2xpY2sgaGVyZX19IHRvIHRyeSBhZ2FpbicsXG4gICAgICB6aDogJ+mqjOivgeetlOahiOi/h+eoi+WPkeeUn+mUmeivr+OAguivt3t754K55Ye76L+Z6YeMfX3ph43or5UnLFxuICAgICAgZnI6ICdVbmUgZXJyZXVyIHNcXCdlc3QgcHJvZHVpdGUgbG9ycyBkZSBsYSB2w6lyaWZpY2F0aW9uIGRlIHZvdHJlIHLDqXBvbnNlLiBzXFwnaWwgdm91cyBwbGHDrnQge3tjbGlxdWV6IGljaX19IHBvdXIgcsOpZXNzYXllcicsXG4gICAgICBwYTogJ+CopOCpgeCoueCovuCooeCoviDgqJzgqLXgqL7gqKwg4Kik4Ki44Kim4KmA4KiVIOColeCosOCoqCDgqLXgqYfgqLLgqYcg4KiX4Kiy4Kik4KmAIOCohuCoiCDgqJXgqL/gqLDgqKrgqL4g4KiV4Kiw4KiV4KmHIOCopuCpgeCorOCovuCosOCoviDgqJXgqYvgqLjgqLzgqL/gqLjgqLwg4KiV4Kiw4KioIOCosuCoiCB7e+Coh+CpseCopeCphyDgqJXgqLLgqL/gqJUg4KiV4Kiw4KmLfX0nLFxuICAgIH0sXG4gIH07XG59XG5cbi8qKlxuICogNyBtdXR1YWxseSBleGNsdXNpdmUgc3RhdGVzLCB0aGUgcHJvZ3JhbSBjYW4gb25seSBiZSBpbiBvbmUgb2YgdGhlc2Ugc3RhdGVcbiAqIGF0IGFueSBnaXZlbiBwb2ludC4uXG4gKi9cbmVudW0gQ0FQVENIQV9TVEFURSB7XG4gIEZFVENISU5HX0NBUFRDSEFfSU1HID0gMSxcbiAgU1VDQ0VTU19GRVRDSF9JTUcgPSAyLFxuICBFUlJPUl9GRVRDSF9JTUcgPSAzLFxuICBWRVJJRllJTkdfQU5TV0VSID0gNCxcbiAgU1VDQ0VTU19WRVJJRllfQU5TV0VSX0NPUlJFQ1QgPSA1LFxuICAvLyBodHRwIGVycm9yIGR1cmluZyB2ZXJpZmljYXRpb24gY2FsbC5cbiAgRVJST1JfVkVSSUZZID0gNixcbiAgLy8gU1VDQ0VTU19WRVJJRllfQU5TV0VSX0lOQ09SUkVDVCA9IDYsXG59XG4iXX0=