<i class="fa fa-info-circle text-muted" (click)="openModal($event)"></i>

<ng-template #personModal>
  <div class="modal-header">
      <h4 class="modal-title">{{person.name}}</h4>
      <button class="btn btn-default pull-right" *ngIf="!editable" (click)="edit()">Edit</button>

      <span *ngIf="editable">
          <button class="btn btn-primary pull-right mx-2" (click)="save()">Save</button>
          <button class="btn btn-default pull-right mx-2" (click)="discard()">Discard</button>
      </span>

  </div>
  <div class="modal-body">
      <form>
        <div class="form-row">
          <div class="form-group col-md-6 row">
            <label class='col-sm-5 col-form-label' for="lastName">Last Name</label>
            <div class="col-sm-7">
              <input type="text" disabled  class="form-control" id="lastName" name="lastName" [(ngModel)]="person.lastName">
            </div>
          </div>
          <div class="form-group col-md-6 row">
            <label class='col-sm-5 col-form-label' for="firstName">First Name</label>
            <div class="col-sm-7">
              <input type="text" disabled  class="form-control" id="firstName" name="firstName" [(ngModel)]="person.firstName">
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group col-md-6 row">
            <label class='col-sm-5 col-form-label' for="middleName">Middle Name</label>
            <div class="col-sm-7">
              <input type="text" disabled  class="form-control" id="middleName" name="middleName" [(ngModel)]="person.middleName">
            </div>
          </div>

          <div class="form-group col-md-6 row">
            <label class='col-sm-5 col-form-label' for="DOB">Date of Birth</label>
            <div class="col-sm-7">
              <input type="text" disabled  class="form-control" id="DOB" name="DOB" [(ngModel)]="person.dateOfBirth">
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group col-md-6 row">
            <label class='col-sm-5 col-form-label' for="primaryPhone">Phone</label>
            <div class="col-sm-7">
              <input type="text" disabled  class="form-control" id="primaryPhone" name="primaryPhone" [(ngModel)]="person.phone">
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group col-md-6 row">
            <label class='col-sm-5 col-form-label' for="email">Email</label>
            <div class="col-sm-7">
              <input type="text" disabled  class="form-control" id="email" name="email" [(ngModel)]="person.email">
            </div>
          </div>
          <div class="form-group col-md-6 row">
            <label class='col-sm-5 col-form-label' for="renewalDate">Renewal Date</label>
            <div class="col-sm-7">
              <input type="text" disabled  class="form-control" id="renewalDate" name="renewalDate" [(ngModel)]="person.renewalDate">
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group col-md-6 row">
            <label class='col-sm-5 col-form-label' for="postal">Postal Code</label>
            <div class="col-sm-7">
              <input type="text" disabled  class="form-control" id="postal" name="postal" [(ngModel)]="person.address.postal">
            </div>
          </div>
        </div>
      </form>

      <div class="card">
        <div class="card-header">
          Enrollments ( {{person.siteAccess.length}} )
        </div>
        <div class="card-body">
          <ul class="list-group list-group-flush">
            <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let siteAccess of person.siteAccess">
              <span>{{ siteAccess.site.name }}</span>
              <ng-container *ngTemplateOutlet="enrollmentDetails;context:{siteAccess: siteAccess}"></ng-container>
            </li>
          </ul>
        </div>
      </div>

    </div>
</ng-template>

<ng-template #siteModal>
  <div class="modal-header">
    <h4 class="modal-title">{{collection.name}}</h4>


    <form *ngIf="!isApplicantSite()" class="form-inline">
      <select class="form-control" [value]="site.objectId"
        (change)="changeSite($event.target.value, $event)">
        <option *ngFor="let memberSite of collection.members" value="{{memberSite.objectId}}">
          {{memberSite.name}}
        </option>
      </select>
    </form>

    <button class="btn btn-default pull-right" *ngIf="!editable && !isApplicantSite()" (click)="edit()">Edit</button>

    <span *ngIf="editable">
        <button class="btn btn-primary pull-right mx-2" (click)="save()">Save</button>
        <button class="btn btn-default pull-right mx-2" (click)="discard()">Discard</button>
    </span>

  </div>
  <div class="modal-body">
      <div class="container">
        <div class="form-row form-group">
          <label class='col-2 col-form-label' for="address">Address</label>
          <div class="col-sm-9 col-xs-12">
            <input type="text" disabled  class="form-control" id="address" name="address" [(ngModel)]="site.address.street">
          </div>
        </div>

        <div class="form-row form-group">
          <label class='col-2 col-form-label' for="siteType">Site Type</label>
          <div class="col-sm-3 col-xs-12">
            <input type="text" disabled  class="form-control" id="siteType" name="siteType" [(ngModel)]="site.siteType">
          </div>

          <label class='col-1 offset-sm-1 col-form-label' for="vendor">Vendor</label>
          <div class="col-sm-4 col-xs-12">
            <input type="text" disabled  class="form-control" id="vendor" name="vendor" [(ngModel)]="site.vendor">
          </div>
        </div>


      </div>

      <div *ngIf="!isApplicantSite()" class="card">
          <div class="card-header">
            Enrollments ( {{site.siteAccess.length}} )
          </div>
          <div class="card-body">
            <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let siteAccess of site.siteAccess">
                  <span>{{siteAccess.person.name}}</span>
                  <ng-container *ngTemplateOutlet="enrollmentDetails;context:{siteAccess: siteAccess}"></ng-container>
                </li>
            </ul>
          </div>
      </div>

  </div>
</ng-template>


<!-- This template is used in both modals and is identical.  -->
<ng-template #enrollmentDetails let-siteAccess="siteAccess">
    <span class='d-flex justify-content-between align-items-center'>
      <span class='d-inline-flex align-items-baseline ml-2'>Start
        <prime-datepicker size='mini' dateFormat="yyyy/mm/dd" [disabled]="!editable" [(date)]="siteAccess.startDate" class='ml-1'></prime-datepicker>
      </span>

      <span class='d-inline-flex align-items-baseline ml-2'>End
        <prime-datepicker size='mini' dateFormat="yyyy/mm/dd" [disabled]="!editable"  [date]="siteAccess.endDate" (dateChange)="onSetEndDate($event, siteAccess)" class='ml-1'></prime-datepicker>
      </span>

      <!-- TODO: Get values programmatically, and save!
        SiteAccess.status should be updated, just need to add a
        (change) to the select and do the logic in the controller -->
      <select *ngIf="shouldShowreasonForDeactivation[siteAccess.objectId]" [@growHorizontal] [disabled]="!editable"
        name="reasonForDeactivation" id="reasonForDeactivation"
        class='mx-2'>
        <option value="noLongerEmployee">No Longer employee</option>
        <option value="contractExpiration">Contract Expiration</option>
        <option value="tempAccess">Temp Access</option>
        <option value="changedLocation">Changed Location</option>
      </select>

      <!-- TODO: Move these to attribtues on the SiteAccess object, and then randomly generate them in DummyDataService. -->
      <span class='d-flex flex-column px-2'>
        <span class='nowrap'>Med Hist</span>
        <span class='nowrap'>Daytime</span>
      </span>

      <prime-pill-badge
        class='ml-2'
        *ngIf="siteAccess.alert.status === 'Expired' || siteAccess.alert.status === 'Active'; else iconOnly"
        [alerts]="[siteAccess.alert]">
      </prime-pill-badge>

      <ng-template #iconOnly>
        <prime-pill-badge
          class='ml-2'
          iconOnly=true
          [alerts]="[siteAccess.alert]">
        </prime-pill-badge>
      </ng-template>

    </span>

</ng-template>
